<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 An Economic Extension of the Schelling Segregation Model | Agent Based Modelling</title>
  <meta name="description" content="Chapter 6 An Economic Extension of the Schelling Segregation Model | Agent Based Modelling" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 An Economic Extension of the Schelling Segregation Model | Agent Based Modelling" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 An Economic Extension of the Schelling Segregation Model | Agent Based Modelling" />
  
  
  

<meta name="author" content="Kamran Afzali" />


<meta name="date" content="2025-10-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="from-random-walks-to-social-segregation-the-schelling-model.html"/>
<link rel="next" href="space-matters-grids-neighborhoods-and-spatial-dynamics.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Agent Based Modelling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Agent Based Modelling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#agent-based-modelling-and-complexity"><i class="fa fa-check"></i><b>1.1</b> Agent-based modelling and complexity</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#structure-of-an-agent-based-model"><i class="fa fa-check"></i><b>1.2</b> Structure of an agent-based model</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#agents"><i class="fa fa-check"></i><b>1.2.1</b> Agents</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#environment"><i class="fa fa-check"></i><b>1.2.2</b> Environment</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#when-to-do-abm"><i class="fa fa-check"></i><b>1.3</b> When to do ABM</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#references"><i class="fa fa-check"></i><b>1.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="random-walks-i.html"><a href="random-walks-i.html"><i class="fa fa-check"></i><b>2</b> Random Walks I</a>
<ul>
<li class="chapter" data-level="2.1" data-path="random-walks-i.html"><a href="random-walks-i.html#what-makes-random-walks-special"><i class="fa fa-check"></i><b>2.1</b> What Makes Random Walks Special?</a></li>
<li class="chapter" data-level="2.2" data-path="random-walks-i.html"><a href="random-walks-i.html#building-our-random-walk-simulation"><i class="fa fa-check"></i><b>2.2</b> Building Our Random Walk Simulation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="random-walks-i.html"><a href="random-walks-i.html#setting-up-the-environment"><i class="fa fa-check"></i><b>2.2.1</b> Setting Up the Environment</a></li>
<li class="chapter" data-level="2.2.2" data-path="random-walks-i.html"><a href="random-walks-i.html#creating-the-random-walker-agent"><i class="fa fa-check"></i><b>2.2.2</b> Creating the Random Walker Agent</a></li>
<li class="chapter" data-level="2.2.3" data-path="random-walks-i.html"><a href="random-walks-i.html#designing-the-model-architecture"><i class="fa fa-check"></i><b>2.2.3</b> Designing the Model Architecture</a></li>
<li class="chapter" data-level="2.2.4" data-path="random-walks-i.html"><a href="random-walks-i.html#implementing-the-simulation-loop"><i class="fa fa-check"></i><b>2.2.4</b> Implementing the Simulation Loop</a></li>
<li class="chapter" data-level="2.2.5" data-path="random-walks-i.html"><a href="random-walks-i.html#running-and-analyzing-the-simulation"><i class="fa fa-check"></i><b>2.2.5</b> Running and Analyzing the Simulation</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="random-walks-i.html"><a href="random-walks-i.html#the-complete-implementation"><i class="fa fa-check"></i><b>2.3</b> The Complete Implementation</a></li>
<li class="chapter" data-level="2.4" data-path="random-walks-i.html"><a href="random-walks-i.html#discussion-and-implications"><i class="fa fa-check"></i><b>2.4</b> Discussion and Implications</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="random-walks-i.html"><a href="random-walks-i.html#from-particles-to-populations"><i class="fa fa-check"></i><b>2.4.1</b> From Particles to Populations</a></li>
<li class="chapter" data-level="2.4.2" data-path="random-walks-i.html"><a href="random-walks-i.html#the-power-of-emergence"><i class="fa fa-check"></i><b>2.4.2</b> The Power of Emergence</a></li>
<li class="chapter" data-level="2.4.3" data-path="random-walks-i.html"><a href="random-walks-i.html#extending-the-framework"><i class="fa fa-check"></i><b>2.4.3</b> Extending the Framework</a></li>
<li class="chapter" data-level="2.4.4" data-path="random-walks-i.html"><a href="random-walks-i.html#computational-insights"><i class="fa fa-check"></i><b>2.4.4</b> Computational Insights</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="random-walks-i.html"><a href="random-walks-i.html#visualizing-the-journey"><i class="fa fa-check"></i><b>2.5</b> Visualizing the Journey</a></li>
<li class="chapter" data-level="2.6" data-path="random-walks-i.html"><a href="random-walks-i.html#conclusion-random-walks-as-research-tools"><i class="fa fa-check"></i><b>2.6</b> Conclusion: Random Walks as Research Tools</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="random-walks-i.html"><a href="random-walks-i.html#full-code"><i class="fa fa-check"></i><b>2.6.1</b> Full Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><i class="fa fa-check"></i><b>3</b> Scaling Up: Multi-Agent Random Walks and Emergent Collective Patterns</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#from-solo-to-symphony-the-multi-agent-paradigm"><i class="fa fa-check"></i><b>3.1</b> From Solo to Symphony: The Multi-Agent Paradigm</a></li>
<li class="chapter" data-level="3.2" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#architectural-improvements-professional-mesa-development"><i class="fa fa-check"></i><b>3.2</b> Architectural Improvements: Professional Mesa Development</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#enhanced-agent-design"><i class="fa fa-check"></i><b>3.2.1</b> Enhanced Agent Design</a></li>
<li class="chapter" data-level="3.2.2" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#professional-data-collection"><i class="fa fa-check"></i><b>3.2.2</b> Professional Data Collection</a></li>
<li class="chapter" data-level="3.2.3" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#scalable-model-architecture"><i class="fa fa-check"></i><b>3.2.3</b> Scalable Model Architecture</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#the-complete-enhanced-implementation"><i class="fa fa-check"></i><b>3.3</b> The Complete Enhanced Implementation</a></li>
<li class="chapter" data-level="3.4" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#emergent-patterns-in-multi-agent-systems"><i class="fa fa-check"></i><b>3.4</b> Emergent Patterns in Multi-Agent Systems</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#collective-coverage-patterns"><i class="fa fa-check"></i><b>3.4.1</b> Collective Coverage Patterns</a></li>
<li class="chapter" data-level="3.4.2" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#spatial-distribution-dynamics"><i class="fa fa-check"></i><b>3.4.2</b> Spatial Distribution Dynamics</a></li>
<li class="chapter" data-level="3.4.3" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#temporal-synchronization-and-divergence"><i class="fa fa-check"></i><b>3.4.3</b> Temporal Synchronization and Divergence</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#data-analysis-opportunities"><i class="fa fa-check"></i><b>3.5</b> Data Analysis Opportunities</a></li>
<li class="chapter" data-level="3.6" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#performance-considerations-and-scalability"><i class="fa fa-check"></i><b>3.6</b> Performance Considerations and Scalability</a></li>
<li class="chapter" data-level="3.7" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#research-applications-and-extensions"><i class="fa fa-check"></i><b>3.7</b> Research Applications and Extensions</a></li>
<li class="chapter" data-level="3.8" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#visualization-and-communication"><i class="fa fa-check"></i><b>3.8</b> Visualization and Communication</a></li>
<li class="chapter" data-level="3.9" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#conclusion-from-randomness-to-understanding"><i class="fa fa-check"></i><b>3.9</b> Conclusion: From Randomness to Understanding</a></li>
<li class="chapter" data-level="3.10" data-path="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html"><a href="scaling-up-multi-agent-random-walks-and-emergent-collective-patterns.html#full-code-1"><i class="fa fa-check"></i><b>3.10</b> Full code</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html"><i class="fa fa-check"></i><b>4</b> Beyond Random: When Agents Learn to Navigate Their World</a>
<ul>
<li class="chapter" data-level="4.1" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#from-random-to-rational-the-learning-paradigm"><i class="fa fa-check"></i><b>4.1</b> From Random to Rational: The Learning Paradigm</a></li>
<li class="chapter" data-level="4.2" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#environmental-complexity-resources-and-hazards"><i class="fa fa-check"></i><b>4.2</b> Environmental Complexity: Resources and Hazards</a></li>
<li class="chapter" data-level="4.3" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#the-architecture-of-adaptive-behavior"><i class="fa fa-check"></i><b>4.3</b> The Architecture of Adaptive Behavior</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#the-exploration-exploitation-dilemma"><i class="fa fa-check"></i><b>4.3.1</b> The Exploration-Exploitation Dilemma</a></li>
<li class="chapter" data-level="4.3.2" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#adaptive-decision-making"><i class="fa fa-check"></i><b>4.3.2</b> Adaptive Decision Making</a></li>
<li class="chapter" data-level="4.3.3" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#learning-through-experience"><i class="fa fa-check"></i><b>4.3.3</b> Learning Through Experience</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#environmental-architecture-and-complexity"><i class="fa fa-check"></i><b>4.4</b> Environmental Architecture and Complexity</a></li>
<li class="chapter" data-level="4.5" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#comprehensive-data-collection-and-analysis"><i class="fa fa-check"></i><b>4.5</b> Comprehensive Data Collection and Analysis</a></li>
<li class="chapter" data-level="4.6" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#the-complete-learning-walker-implementation"><i class="fa fa-check"></i><b>4.6</b> The Complete Learning Walker Implementation</a></li>
<li class="chapter" data-level="4.7" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#emergent-intelligence-what-the-data-reveals"><i class="fa fa-check"></i><b>4.7</b> Emergent Intelligence: What the Data Reveals</a></li>
<li class="chapter" data-level="4.8" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#research-implications-and-real-world-connections"><i class="fa fa-check"></i><b>4.8</b> Research Implications and Real-World Connections</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#extensions-and-future-directions"><i class="fa fa-check"></i><b>4.8.1</b> Extensions and Future Directions</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#computational-insights-and-performance"><i class="fa fa-check"></i><b>4.9</b> Computational Insights and Performance</a></li>
<li class="chapter" data-level="4.10" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#conclusion-intelligence-as-emergent-property"><i class="fa fa-check"></i><b>4.10</b> Conclusion: Intelligence as Emergent Property</a></li>
<li class="chapter" data-level="4.11" data-path="beyond-random-when-agents-learn-to-navigate-their-world.html"><a href="beyond-random-when-agents-learn-to-navigate-their-world.html#full-code-2"><i class="fa fa-check"></i><b>4.11</b> Full code</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html"><i class="fa fa-check"></i><b>5</b> From Random Walks to Social Segregation: The Schelling Model</a>
<ul>
<li class="chapter" data-level="5.1" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#the-mechanics-of-social-preference"><i class="fa fa-check"></i><b>5.1</b> The Mechanics of Social Preference</a></li>
<li class="chapter" data-level="5.2" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#implementation-architecture-and-design-decisions"><i class="fa fa-check"></i><b>5.2</b> Implementation Architecture and Design Decisions</a></li>
<li class="chapter" data-level="5.3" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#the-emergence-of-segregated-patterns"><i class="fa fa-check"></i><b>5.3</b> The Emergence of Segregated Patterns</a></li>
<li class="chapter" data-level="5.4" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#quantifying-segregation-dynamics"><i class="fa fa-check"></i><b>5.4</b> Quantifying Segregation Dynamics</a></li>
<li class="chapter" data-level="5.5" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#extensions-and-variations"><i class="fa fa-check"></i><b>5.5</b> Extensions and Variations</a></li>
<li class="chapter" data-level="5.6" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#policy-implications-and-interventions"><i class="fa fa-check"></i><b>5.6</b> Policy Implications and Interventions</a></li>
<li class="chapter" data-level="5.7" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#computational-considerations-and-future-directions"><i class="fa fa-check"></i><b>5.7</b> Computational Considerations and Future Directions</a></li>
<li class="chapter" data-level="5.8" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#connecting-theory-and-reality"><i class="fa fa-check"></i><b>5.8</b> Connecting Theory and Reality</a></li>
<li class="chapter" data-level="5.9" data-path="from-random-walks-to-social-segregation-the-schelling-model.html"><a href="from-random-walks-to-social-segregation-the-schelling-model.html#emergence-and-individual-responsibility"><i class="fa fa-check"></i><b>5.9</b> Emergence and Individual Responsibility</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html"><i class="fa fa-check"></i><b>6</b> An Economic Extension of the Schelling Segregation Model</a>
<ul>
<li class="chapter" data-level="6.1" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html#introduction-the-missing-economic-dimension"><i class="fa fa-check"></i><b>6.1</b> Introduction: The Missing Economic Dimension</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html#redefining-agents-in-economic-terms"><i class="fa fa-check"></i><b>6.1.1</b> Redefining Agents in Economic Terms</a></li>
<li class="chapter" data-level="6.1.2" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html#emergent-dynamics-when-constraints-reshape-preferences"><i class="fa fa-check"></i><b>6.1.2</b> Emergent Dynamics: When Constraints Reshape Preferences</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html#research-applications-from-theory-to-policy"><i class="fa fa-check"></i><b>6.2</b> Research Applications: From Theory to Policy</a></li>
<li class="chapter" data-level="6.3" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html#methodological-innovations-and-extensions"><i class="fa fa-check"></i><b>6.3</b> Methodological Innovations and Extensions</a></li>
<li class="chapter" data-level="6.4" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html#key-findings-the-economic-reality-of-social-sorting"><i class="fa fa-check"></i><b>6.4</b> Key Findings: The Economic Reality of Social Sorting</a></li>
<li class="chapter" data-level="6.5" data-path="an-economic-extension-of-the-schelling-segregation-model.html"><a href="an-economic-extension-of-the-schelling-segregation-model.html#conclusion"><i class="fa fa-check"></i><b>6.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><i class="fa fa-check"></i><b>7</b> Space Matters: Grids, Neighborhoods, and Spatial Dynamics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#the-architecture-of-space-in-agent-based-models"><i class="fa fa-check"></i><b>7.1</b> The Architecture of Space in Agent-Based Models</a></li>
<li class="chapter" data-level="7.2" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#conways-game-of-life-emergence-from-simplicity"><i class="fa fa-check"></i><b>7.2</b> Conway’s Game of Life: Emergence from Simplicity</a></li>
<li class="chapter" data-level="7.3" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#patterns-structures-and-emergent-behaviors"><i class="fa fa-check"></i><b>7.3</b> Patterns, Structures, and Emergent Behaviors</a></li>
<li class="chapter" data-level="7.4" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#boundary-conditions-and-spatial-topology"><i class="fa fa-check"></i><b>7.4</b> Boundary Conditions and Spatial Topology</a></li>
<li class="chapter" data-level="7.5" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#extending-the-framework-custom-rules-and-variations"><i class="fa fa-check"></i><b>7.5</b> Extending the Framework: Custom Rules and Variations</a></li>
<li class="chapter" data-level="7.6" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#computational-complexity-and-performance-considerations"><i class="fa fa-check"></i><b>7.6</b> Computational Complexity and Performance Considerations</a></li>
<li class="chapter" data-level="7.7" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#connections-to-complex-systems-theory"><i class="fa fa-check"></i><b>7.7</b> Connections to Complex Systems Theory</a></li>
<li class="chapter" data-level="7.8" data-path="space-matters-grids-neighborhoods-and-spatial-dynamics.html"><a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html#spatial-dynamics-and-future-directions"><i class="fa fa-check"></i><b>7.8</b> Spatial Dynamics and Future Directions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Agent Based Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="an-economic-extension-of-the-schelling-segregation-model" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> An Economic Extension of the Schelling Segregation Model<a href="an-economic-extension-of-the-schelling-segregation-model.html#an-economic-extension-of-the-schelling-segregation-model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-the-missing-economic-dimension" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Introduction: The Missing Economic Dimension<a href="an-economic-extension-of-the-schelling-segregation-model.html#introduction-the-missing-economic-dimension" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Thomas Schelling’s agent-based model of segregation stands as one of the most influential contributions to computational social science. Its elegant demonstration—that severe residential segregation can emerge from surprisingly mild homophilic preferences—has shaped decades of research on urban dynamics and social sorting. Yet for all its theoretical power, the classical Schelling model omits a dimension that fundamentally shapes real-world residential decisions: economics.</p>
<p>In Schelling’s canonical framework, an agent <span class="math inline">\(i\)</span> of type <span class="math inline">\(\tau_i \in \{0, 1\}\)</span> located at position <span class="math inline">\(p_i\)</span> seeks to relocate when the proportion of same-type neighbors falls below a similarity threshold <span class="math inline">\(\theta\)</span>. Formally, if the local similarity ratio:</p>
<p><span class="math display">\[S_i = \frac{1}{|N(p_i)|} \sum_{j \in N(p_i)} \mathbb{I}(\tau_j = \tau_i)\]</span></p>
<p>drops below <span class="math inline">\(\theta\)</span>, the agent becomes “unhappy” and seeks a new location. While this framework brilliantly illuminates how individual preferences aggregate into collective patterns, it assumes something that rarely holds in practice: that all agents have equal economic capacity to act on their preferences.</p>
<p>This article presents a formal extension that integrates economic heterogeneity and housing market dynamics into the Schelling framework. By introducing income disparities, wealth accumulation, and location-dependent costs, we reveal how financial constraints act as a powerful secondary sorting mechanism—often amplifying and entrenching the segregation patterns that emerge from social preferences alone.</p>
<div id="redefining-agents-in-economic-terms" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Redefining Agents in Economic Terms<a href="an-economic-extension-of-the-schelling-segregation-model.html#redefining-agents-in-economic-terms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our extension fundamentally reimagines the agent. Rather than the simple <span class="math inline">\((type, position)\)</span> tuple of the original model, each agent <span class="math inline">\(i\)</span> is now characterized by the state vector <span class="math inline">\((\tau_i, I_i, W_i)\)</span>, representing social type, income, and accumulated wealth respectively.</p>
<p>The introduction of systematic income inequality forms a cornerstone of our approach. Agent income <span class="math inline">\(I_i\)</span> is drawn from type-conditional distributions that reflect real-world disparities:</p>
<p><span class="math display">\[I_i \sim \mathcal{N}(\mu_{\tau_i}, \sigma_{income}^2), \quad \text{where} \quad \mu_{minority} &lt; \mu_{majority}\]</span></p>
<p>This seemingly simple modification has profound implications. It introduces a fundamental asymmetry that mirrors documented patterns of economic inequality while providing a mechanism through which initial disparities can compound over time.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-1" tabindex="-1"></a><span class="kw">def</span> _generate_income(<span class="va">self</span>, agent_type: AgentType) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb29-2"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-2" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb29-3"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-3" tabindex="-1"></a><span class="co">    Generate income for an agent based on type with systematic inequality.</span></span>
<span id="cb29-4"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-4" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb29-5"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-5" tabindex="-1"></a>    base_income <span class="op">=</span> (<span class="va">self</span>.majority_base_income <span class="cf">if</span> agent_type <span class="op">==</span> AgentType.MAJORITY</span>
<span id="cb29-6"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-6" tabindex="-1"></a>                   <span class="cf">else</span> <span class="va">self</span>.minority_base_income)</span>
<span id="cb29-7"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-7" tabindex="-1"></a></span>
<span id="cb29-8"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-8" tabindex="-1"></a>    income <span class="op">=</span> np.random.normal(base_income, <span class="va">self</span>.income_variance)</span>
<span id="cb29-9"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb29-9" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="fl">0.0</span>, income)  <span class="co"># Ensure non-negative income</span></span></code></pre></div>
<p>The static, uniform cost structure of the original Schelling model gives way to a heterogeneous economic landscape. We introduce a rent function <span class="math inline">\(R: P \to \mathbb{R}^+\)</span> that assigns costs to each location <span class="math inline">\(p\)</span> in the grid <span class="math inline">\(P\)</span>. This enables modeling of diverse urban forms—from linear gradients representing center-periphery dynamics to clustered patterns reflecting neighborhood-specific amenities.</p>
<p>More critically, we model wealth as a dynamic quantity. An agent’s accumulated wealth <span class="math inline">\(W_{i,t}\)</span> evolves according to:</p>
<p><span class="math display">\[W_{i,t+1} = W_{i,t} + I_i - R(p_{i,t})\]</span></p>
<p>This deceptively simple equation captures a fundamental economic reality: housing costs consume income, and the remainder either builds or depletes wealth over time. Agents in expensive locations face persistent wealth drainage, while those in affordable areas can accumulate resources for future mobility.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb30-1" tabindex="-1"></a><span class="kw">def</span> earn_income(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb30-2"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb30-2" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Agent earns income and pays rent, adding net to accumulated wealth.&quot;&quot;&quot;</span></span>
<span id="cb30-3"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb30-3" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span>.pos <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb30-4"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb30-4" tabindex="-1"></a>        rent <span class="op">=</span> <span class="va">self</span>.model.rent_grid[<span class="va">self</span>.pos]</span>
<span id="cb30-5"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb30-5" tabindex="-1"></a>        net_income <span class="op">=</span> <span class="va">self</span>.income <span class="op">-</span> rent</span>
<span id="cb30-6"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb30-6" tabindex="-1"></a>        <span class="va">self</span>.accumulated_wealth <span class="op">+=</span> net_income</span>
<span id="cb30-7"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb30-7" tabindex="-1"></a>        <span class="va">self</span>.accumulated_wealth <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, <span class="va">self</span>.accumulated_wealth)</span></code></pre></div>
<p>The model’s central innovation lies in how it handles agent decision-making. Social unhappiness (<span class="math inline">\(S_i &lt; \theta\)</span>) becomes a <em>necessary but not sufficient</em> condition for relocation. Movement to a new location <span class="math inline">\(p&#39;\)</span> requires satisfying two economic constraints:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Moving Capacity</strong>: Current wealth must exceed moving costs
<span class="math display">\[W_{i,t} \geq C_{move}\]</span></p></li>
<li><p><strong>Affordability</strong>: Income must cover new location’s rent
<span class="math display">\[I_i \geq R(p&#39;)\]</span></p></li>
</ol>
<p>This dual-constraint framework creates a filtered choice set where agents can only consider relocations that are both socially desirable and economically feasible.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-1" tabindex="-1"></a><span class="kw">def</span> _get_affordable_empty_cells(<span class="va">self</span>) <span class="op">-&gt;</span> List[Tuple[<span class="bu">int</span>, <span class="bu">int</span>]]:</span>
<span id="cb31-2"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-2" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Get list of empty cells that agent can afford.&quot;&quot;&quot;</span></span>
<span id="cb31-3"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-3" tabindex="-1"></a>    affordable_cells <span class="op">=</span> []</span>
<span id="cb31-4"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-4" tabindex="-1"></a>    empty_cells <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>.model.grid.empties)</span>
<span id="cb31-5"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-5" tabindex="-1"></a></span>
<span id="cb31-6"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-6" tabindex="-1"></a>    <span class="co"># Condition 1: Agent must have enough wealth for moving cost</span></span>
<span id="cb31-7"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-7" tabindex="-1"></a>    available_wealth <span class="op">=</span> <span class="va">self</span>.accumulated_wealth <span class="op">-</span> <span class="va">self</span>.model.moving_cost</span>
<span id="cb31-8"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-8" tabindex="-1"></a></span>
<span id="cb31-9"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-9" tabindex="-1"></a>    <span class="cf">for</span> cell <span class="kw">in</span> empty_cells:</span>
<span id="cb31-10"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-10" tabindex="-1"></a>        rent <span class="op">=</span> <span class="va">self</span>.model.rent_grid[cell]</span>
<span id="cb31-11"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-11" tabindex="-1"></a>        <span class="co"># Condition 2: Agent must be able to afford the new rent</span></span>
<span id="cb31-12"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-12" tabindex="-1"></a>        <span class="cf">if</span> available_wealth <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.income <span class="op">&gt;=</span> rent:</span>
<span id="cb31-13"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-13" tabindex="-1"></a>            affordable_cells.append(cell)</span>
<span id="cb31-14"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-14" tabindex="-1"></a></span>
<span id="cb31-15"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb31-15" tabindex="-1"></a>    <span class="cf">return</span> affordable_cells</span></code></pre></div>
<p>The economic extension demands new analytical frameworks. While social segregation remains important, we must also quantify economic sorting patterns and their interaction.</p>
<p><strong>Social Segregation Index</strong> (<span class="math inline">\(Seg_{social}\)</span>) maintains the classical Schelling metric:</p>
<p><span class="math display">\[Seg_{social} = \frac{\sum_{i \in \text{Agents}} \sum_{j \in N(p_i)} \mathbb{I}(\tau_j = \tau_i)}{\sum_{i \in \text{Agents}} |N(p_i)|}\]</span></p>
<p><strong>Economic Segregation Index</strong> (<span class="math inline">\(Seg_{econ}\)</span>) introduces a novel measure of income-based clustering. We define income similarity between agents <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> as:</p>
<p><span class="math display">\[Sim(I_i, I_j) = 1 - \frac{|I_i - I_j|}{\max(I_i, I_j, \epsilon)}\]</span></p>
<p>where <span class="math inline">\(\epsilon\)</span> prevents division by zero. The economic segregation index then becomes:</p>
<p><span class="math display">\[Seg_{econ} = \frac{1}{\sum_i |N(p_i)|} \sum_{i \in \text{Agents}} \sum_{j \in N(p_i)} Sim(I_i, I_j)\]</span></p>
<p>These dual metrics enable decomposition of observed segregation into social and economic components, revealing the relative contribution of preferences versus constraints.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-1" tabindex="-1"></a><span class="va">self</span>.datacollector <span class="op">=</span> DataCollector(</span>
<span id="cb32-2"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-2" tabindex="-1"></a>    model_reporters<span class="op">=</span>{</span>
<span id="cb32-3"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-3" tabindex="-1"></a>        <span class="st">&quot;Segregation&quot;</span>: <span class="va">self</span>.calculate_segregation,</span>
<span id="cb32-4"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-4" tabindex="-1"></a>        <span class="st">&quot;Economic_Segregation&quot;</span>: <span class="va">self</span>.calculate_economic_segregation,</span>
<span id="cb32-5"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-5" tabindex="-1"></a>        <span class="st">&quot;Avg_Wealth_Majority&quot;</span>: <span class="kw">lambda</span> m: <span class="va">self</span>._calculate_avg_wealth(AgentType.MAJORITY),</span>
<span id="cb32-6"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-6" tabindex="-1"></a>        <span class="st">&quot;Avg_Wealth_Minority&quot;</span>: <span class="kw">lambda</span> m: <span class="va">self</span>._calculate_avg_wealth(AgentType.MINORITY),</span>
<span id="cb32-7"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-7" tabindex="-1"></a>    }</span>
<span id="cb32-8"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb32-8" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="emergent-dynamics-when-constraints-reshape-preferences" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Emergent Dynamics: When Constraints Reshape Preferences<a href="an-economic-extension-of-the-schelling-segregation-model.html#emergent-dynamics-when-constraints-reshape-preferences" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Perhaps the most striking finding from the economic extension is the emergence of “frustrated equilibria”—states where significant numbers of agents remain socially unhappy but economically immobile. Unlike the classical Schelling model, where movement continues until all agents achieve satisfaction (or no moves improve satisfaction), the economic version often reaches stable states with persistent unhappiness.</p>
<p>This frustration is not randomly distributed. Lower-income agents, particularly minorities, become systematically trapped in socially undesirable but economically necessary locations. Their preferences remain unchanged, but their capacity to act on those preferences becomes severely constrained.</p>
<p>Social and economic sorting operate not as independent processes but as coupled dynamics. Economic constraints filter the choice sets available to socially motivated agents, creating sorting patterns that reflect both preference and capacity. This coupling produces several counterintuitive results:</p>
<ul>
<li><strong>Preference Amplification</strong>: Mild social preferences can produce extreme segregation when filtered through economic constraints</li>
<li><strong>Constraint Multiplication</strong>: Economic limitations compound over time as wealth differences accumulate</li>
<li><strong>Spatial Correlation</strong>: Agent type, income, and local costs become strongly correlated, creating reinforcing patterns</li>
</ul>
<p>The model consistently produces widening wealth gaps between groups. This occurs through a mechanism we term “spatial wealth drainage”—lower-income agents who manage to access higher-cost areas face persistent wealth depletion, while higher-income agents accumulate wealth more effectively by avoiding this drain.</p>
<p>Simultaneously, the geography of choice becomes increasingly constrained. As wealth gaps widen, the set of mutually affordable locations for different income groups shrinks, creating what amount to “spatial traps” that lock in segregation patterns.</p>
</div>
</div>
<div id="research-applications-from-theory-to-policy" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Research Applications: From Theory to Policy<a href="an-economic-extension-of-the-schelling-segregation-model.html#research-applications-from-theory-to-policy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Economic Schelling Model transcends academic exercise to provide practical tools for policy analysis. By comparing social versus economic segregation indices across different parameter settings, planners can diagnose whether observed patterns stem primarily from discriminatory preferences or economic inequality.</p>
<p>This diagnostic capability proves crucial for intervention design. If economic segregation substantially exceeds social segregation, income-based interventions (housing vouchers, subsidized housing) may prove more effective than anti-discrimination efforts alone. Conversely, when social segregation dominates, preference-changing interventions become paramount.</p>
<p>The rent gradient feature enables sophisticated modeling of gentrification processes. As certain areas become more expensive, the model simulates how existing residents—particularly lower-income minorities—face displacement pressures even without explicit discrimination. This illuminates how market forces alone can perpetuate segregation through seemingly neutral economic processes.</p>
<p>The model’s greatest practical value may lie in its capacity for <em>ex ante</em> policy evaluation. Rather than implementing costly interventions and observing results, policymakers can simulate various approaches:</p>
<ul>
<li><strong>Housing Voucher Programs</strong>: Model runs predict whether vouchers promote genuine integration or merely redistribute segregation to new areas</li>
<li><strong>Minimum Wage Increases</strong>: Income adjustments reveal how wage policy affects residential mobility and segregation patterns<br />
</li>
<li><strong>Rent Control Policies</strong>: Simulations capture both affordability benefits and potential mobility restrictions from rent regulation</li>
</ul>
</div>
<div id="methodological-innovations-and-extensions" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Methodological Innovations and Extensions<a href="an-economic-extension-of-the-schelling-segregation-model.html#methodological-innovations-and-extensions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The economic extension introduces sophisticated data collection that captures dynamics at multiple scales:</p>
<ul>
<li><strong>Individual Level</strong>: Wealth trajectories, mobility histories, constraint patterns</li>
<li><strong>Group Level</strong>: Demographic-specific outcomes and between-group disparities<br />
</li>
<li><strong>Neighborhood Level</strong>: Local segregation indices, rent distributions, mobility flows</li>
<li><strong>System Level</strong>: Aggregate segregation measures, policy effectiveness metrics</li>
</ul>
<p>This multi-scale approach enables researchers to trace how individual-level constraints aggregate into neighborhood-level patterns and system-level outcomes.</p>
<p>A key methodological advance involves distinguishing between <em>wanting</em> to move and <em>being able</em> to move. Traditional models assume agents can act on preferences; our model recognizes that structural constraints often prevent preference expression. This creates more realistic dynamics and reveals hidden sources of segregation persistence.</p>
<p>By monitoring individual wealth accumulation over time, the model captures how initial conditions compound into long-term inequality. This longitudinal perspective reveals whether segregation patterns are self-reinforcing or whether mobility opportunities can break cycles of disadvantage.</p>
</div>
<div id="key-findings-the-economic-reality-of-social-sorting" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Key Findings: The Economic Reality of Social Sorting<a href="an-economic-extension-of-the-schelling-segregation-model.html#key-findings-the-economic-reality-of-social-sorting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Even when all agents share identical social preferences, systematic income differences create persistent and widening wealth gaps. Lower-income agents spend larger income fractions on housing, leaving less for wealth building and future mobility. This creates a reinforcing cycle where initial economic disadvantage becomes compounded over time.</p>
<p>Analysis reveals that typically 20-40% of agents who are socially motivated to move cannot afford to relocate. This “mobility gap” amplifies segregation beyond what preferences alone would generate, suggesting that economic barriers may be as important as social attitudes in maintaining segregation.</p>
<p>Different rent distribution patterns produce dramatically different segregation outcomes:</p>
<ul>
<li><strong>Uniform Rent</strong>: Segregation driven primarily by social preferences, resembling classical Schelling dynamics</li>
<li><strong>Gradient Rent</strong>: Economic sorting dominates, with minorities concentrated in low-rent periphery regardless of social preferences</li>
<li><strong>Clustered Rent</strong>: Complex patterns emerge combining both economic and social sorting mechanisms</li>
</ul>
<p>The model reveals that intervention effectiveness depends critically on initial conditions:</p>
<ul>
<li><strong>High Inequality Settings</strong>: Direct income support shows greatest segregation reduction</li>
<li><strong>Moderate Inequality</strong>: Housing vouchers demonstrate optimal impact on integration</li>
<li><strong>Low Inequality</strong>: Moving assistance and transaction cost reduction prove most effective</li>
</ul>
</div>
<div id="conclusion" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Conclusion<a href="an-economic-extension-of-the-schelling-segregation-model.html#conclusion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The current model treats income as exogenously fixed, but real-world segregation interacts dynamically with employment access. Future extensions could model how residential location affects job prospects, creating feedback loops between housing and economic outcomes. This would capture how segregation can perpetuate itself through reduced access to employment opportunities.</p>
<p>Present agents make purely individual decisions, but actual residential choices involve social networks, family connections, and community ties. Incorporating network effects could reveal how social capital interacts with economic constraints to either facilitate or hinder mobility across group boundaries.</p>
<p>The model currently abstracts away important institutional features like school district boundaries, public transportation networks, or discriminatory lending practices. These institutional structures often shape residential patterns as powerfully as individual choices, suggesting fertile ground for future model extensions.</p>
<p>Agent preferences remain static throughout simulation runs, but real preferences evolve through experience and contact. Modeling how positive or negative inter-group interactions affect future preferences could illuminate potential paths toward greater long-term integration.</p>
<p>The Economic Schelling Model reveals a sobering yet actionable truth: residential segregation persists not merely through discriminatory preferences but through the systematic interaction between social attitudes and economic constraints. Even in the absence of strong prejudice, economic inequality alone can generate and maintain significant segregation patterns.</p>
<p><strong>For researchers</strong>, the model demonstrates the critical importance of incorporating structural constraints into social simulations. Models focusing exclusively on preferences or purely on economics miss crucial interaction effects that shape real-world outcomes. The economic extension shows how seemingly neutral market forces can amplify social divisions, creating segregation that exceeds what either mechanism would produce independently.</p>
<p><strong>For policymakers</strong>, the findings suggest that effective anti-segregation efforts must address both attitudinal and structural barriers. Anti-discrimination enforcement, while necessary, proves insufficient when economic inequalities continue limiting housing choices for disadvantaged groups. The model’s policy simulation capabilities offer tools for designing interventions that target root causes rather than merely treating symptoms.</p>
<p><strong>For society</strong>, the model provides both warning and hope. The warning is clear: segregation can persist and even worsen through ostensibly neutral economic processes. Market mechanisms, left unchecked, can create self-reinforcing cycles that entrench spatial inequality across generations.</p>
<p>Yet the model also offers hope through understanding. By making explicit the pathways through which economic structures shape social outcomes, we gain tools for interventions that could redirect these forces toward more equitable ends. The path from individual economic constraints to collective segregation patterns is neither simple nor inevitable—it emerges from specific structural relationships that thoughtful policy can potentially reshape.</p>
<p>In our era of rising inequality, the Economic Schelling Model provides essential insights into how economic forces interact with social preferences to shape community formation. It reminds us that creating genuinely integrated communities requires addressing not just individual attitudes but the economic structures that constrain where people can afford to live, work, and build wealth.</p>
<p>The model ultimately demonstrates that emergence—the phenomenon by which simple individual behaviors aggregate into complex collective patterns—operates not just in physical systems but in the intricate dance between economic structures and social choices that defines modern urban life. Understanding this emergence becomes essential for anyone seeking to build more equitable communities in an economically stratified world.</p>
<p>As we grapple with persistent segregation despite decades of civil rights progress, the Economic Schelling Model suggests that the next frontier lies not in changing preferences alone, but in reshaping the economic foundations that determine which preferences can be expressed and which must remain forever frustrated by financial reality.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-1" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-2"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-2" tabindex="-1"></a><span class="co">Improved Economic Schelling Segregation Model</span></span>
<span id="cb33-3"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-3" tabindex="-1"></a><span class="co">Extension of Thomas Schelling&#39;s model with income inequality between groups.</span></span>
<span id="cb33-4"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-4" tabindex="-1"></a><span class="co">Minority agents have systematically lower income than majority agents.</span></span>
<span id="cb33-5"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-5" tabindex="-1"></a></span>
<span id="cb33-6"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-6" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-7"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-7" tabindex="-1"></a></span>
<span id="cb33-8"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-8" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-9"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-9" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb33-10"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-10" tabindex="-1"></a><span class="im">from</span> mesa <span class="im">import</span> Agent, Model</span>
<span id="cb33-11"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-11" tabindex="-1"></a><span class="im">from</span> mesa.time <span class="im">import</span> RandomActivation</span>
<span id="cb33-12"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-12" tabindex="-1"></a><span class="im">from</span> mesa.space <span class="im">import</span> MultiGrid</span>
<span id="cb33-13"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-13" tabindex="-1"></a><span class="im">from</span> mesa.datacollection <span class="im">import</span> DataCollector</span>
<span id="cb33-14"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-14" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Optional, Dict, Any</span>
<span id="cb33-15"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-15" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb33-16"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-16" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="cb33-17"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-17" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb33-18"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-18" tabindex="-1"></a></span>
<span id="cb33-19"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-19" tabindex="-1"></a><span class="co"># Configure logging</span></span>
<span id="cb33-20"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-20" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO)</span>
<span id="cb33-21"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-21" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb33-22"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-22" tabindex="-1"></a></span>
<span id="cb33-23"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-23" tabindex="-1"></a><span class="kw">class</span> AgentType(Enum):</span>
<span id="cb33-24"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-24" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Enumeration for agent types&quot;&quot;&quot;</span></span>
<span id="cb33-25"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-25" tabindex="-1"></a>    MAJORITY <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-26"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-26" tabindex="-1"></a>    MINORITY <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb33-27"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-27" tabindex="-1"></a></span>
<span id="cb33-28"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-28" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb33-29"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-29" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.name.capitalize()</span>
<span id="cb33-30"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-30" tabindex="-1"></a></span>
<span id="cb33-31"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-31" tabindex="-1"></a><span class="kw">class</span> EconomicSchellingAgent(Agent):</span>
<span id="cb33-32"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-32" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-33"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-33" tabindex="-1"></a><span class="co">    An agent in the Economic Schelling segregation model.</span></span>
<span id="cb33-34"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-34" tabindex="-1"></a></span>
<span id="cb33-35"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-35" tabindex="-1"></a><span class="co">    Attributes:</span></span>
<span id="cb33-36"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-36" tabindex="-1"></a><span class="co">        unique_id: Unique identifier for the agent</span></span>
<span id="cb33-37"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-37" tabindex="-1"></a><span class="co">        model: Reference to the model instance</span></span>
<span id="cb33-38"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-38" tabindex="-1"></a><span class="co">        type: Agent type (MAJORITY or MINORITY)</span></span>
<span id="cb33-39"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-39" tabindex="-1"></a><span class="co">        income: Agent&#39;s income level per time step</span></span>
<span id="cb33-40"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-40" tabindex="-1"></a><span class="co">        happiness_threshold: Minimum similarity ratio for happiness</span></span>
<span id="cb33-41"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-41" tabindex="-1"></a><span class="co">        accumulated_wealth: Wealth accumulated over time</span></span>
<span id="cb33-42"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-42" tabindex="-1"></a><span class="co">        initial_wealth: Starting wealth for the agent</span></span>
<span id="cb33-43"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-43" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb33-44"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-44" tabindex="-1"></a></span>
<span id="cb33-45"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-45" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb33-46"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-46" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb33-47"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-47" tabindex="-1"></a>        unique_id: <span class="bu">int</span>,</span>
<span id="cb33-48"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-48" tabindex="-1"></a>        model: <span class="st">&#39;EconomicSchellingModel&#39;</span>,</span>
<span id="cb33-49"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-49" tabindex="-1"></a>        agent_type: AgentType,</span>
<span id="cb33-50"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-50" tabindex="-1"></a>        income: <span class="bu">float</span>,</span>
<span id="cb33-51"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-51" tabindex="-1"></a>        initial_wealth: <span class="bu">float</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb33-52"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-52" tabindex="-1"></a>    ):</span>
<span id="cb33-53"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-53" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-54"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-54" tabindex="-1"></a><span class="co">        Initialize an Economic Schelling agent.</span></span>
<span id="cb33-55"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-55" tabindex="-1"></a></span>
<span id="cb33-56"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-56" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb33-57"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-57" tabindex="-1"></a><span class="co">            unique_id: Unique identifier for the agent</span></span>
<span id="cb33-58"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-58" tabindex="-1"></a><span class="co">            model: Reference to the model instance</span></span>
<span id="cb33-59"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-59" tabindex="-1"></a><span class="co">            agent_type: Agent type (MAJORITY or MINORITY)</span></span>
<span id="cb33-60"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-60" tabindex="-1"></a><span class="co">            income: Agent&#39;s income level per time step</span></span>
<span id="cb33-61"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-61" tabindex="-1"></a><span class="co">            initial_wealth: Initial wealth (defaults to 3x income if not provided)</span></span>
<span id="cb33-62"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-62" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-63"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-63" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(unique_id, model)</span>
<span id="cb33-64"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-64" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">type</span> <span class="op">=</span> agent_type</span>
<span id="cb33-65"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-65" tabindex="-1"></a>        <span class="va">self</span>.income <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, income)  <span class="co"># Ensure non-negative income</span></span>
<span id="cb33-66"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-66" tabindex="-1"></a>        <span class="va">self</span>.happiness_threshold <span class="op">=</span> model.similarity_threshold</span>
<span id="cb33-67"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-67" tabindex="-1"></a>        <span class="va">self</span>.accumulated_wealth <span class="op">=</span> initial_wealth <span class="cf">if</span> initial_wealth <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> income <span class="op">*</span> <span class="fl">3.0</span></span>
<span id="cb33-68"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-68" tabindex="-1"></a>        <span class="va">self</span>.initial_wealth <span class="op">=</span> <span class="va">self</span>.accumulated_wealth</span>
<span id="cb33-69"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-69" tabindex="-1"></a></span>
<span id="cb33-70"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-70" tabindex="-1"></a>    <span class="kw">def</span> step(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-71"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-71" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-72"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-72" tabindex="-1"></a><span class="co">        Agent&#39;s behavior for each step:</span></span>
<span id="cb33-73"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-73" tabindex="-1"></a><span class="co">        1. Calculate similarity ratio with neighbors</span></span>
<span id="cb33-74"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-74" tabindex="-1"></a><span class="co">        2. Move if unhappy and can afford to move</span></span>
<span id="cb33-75"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-75" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-76"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-76" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.pos <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb33-77"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-77" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb33-78"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-78" tabindex="-1"></a></span>
<span id="cb33-79"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-79" tabindex="-1"></a>        <span class="co"># Get neighbors</span></span>
<span id="cb33-80"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-80" tabindex="-1"></a>        neighbors <span class="op">=</span> <span class="va">self</span>.model.grid.get_neighbors(</span>
<span id="cb33-81"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-81" tabindex="-1"></a>            <span class="va">self</span>.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span></span>
<span id="cb33-82"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-82" tabindex="-1"></a>        )</span>
<span id="cb33-83"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-83" tabindex="-1"></a></span>
<span id="cb33-84"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-84" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> neighbors:</span>
<span id="cb33-85"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-85" tabindex="-1"></a>            <span class="cf">return</span>  <span class="co"># No neighbors to compare with</span></span>
<span id="cb33-86"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-86" tabindex="-1"></a></span>
<span id="cb33-87"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-87" tabindex="-1"></a>        <span class="co"># Count similar neighbors</span></span>
<span id="cb33-88"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-88" tabindex="-1"></a>        similar <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors <span class="cf">if</span> neighbor.<span class="bu">type</span> <span class="op">==</span> <span class="va">self</span>.<span class="bu">type</span>)</span>
<span id="cb33-89"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-89" tabindex="-1"></a></span>
<span id="cb33-90"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-90" tabindex="-1"></a>        <span class="co"># Check if agent is unhappy</span></span>
<span id="cb33-91"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-91" tabindex="-1"></a>        similarity_ratio <span class="op">=</span> similar <span class="op">/</span> <span class="bu">len</span>(neighbors)</span>
<span id="cb33-92"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-92" tabindex="-1"></a>        is_unhappy <span class="op">=</span> similarity_ratio <span class="op">&lt;</span> <span class="va">self</span>.happiness_threshold</span>
<span id="cb33-93"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-93" tabindex="-1"></a></span>
<span id="cb33-94"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-94" tabindex="-1"></a>        <span class="co"># Check if agent can afford to move</span></span>
<span id="cb33-95"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-95" tabindex="-1"></a>        can_afford_move <span class="op">=</span> <span class="va">self</span>.accumulated_wealth <span class="op">&gt;=</span> <span class="va">self</span>.model.moving_cost</span>
<span id="cb33-96"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-96" tabindex="-1"></a></span>
<span id="cb33-97"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-97" tabindex="-1"></a>        <span class="cf">if</span> is_unhappy <span class="kw">and</span> can_afford_move:</span>
<span id="cb33-98"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-98" tabindex="-1"></a>            <span class="va">self</span>._move_to_affordable_cell()</span>
<span id="cb33-99"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-99" tabindex="-1"></a></span>
<span id="cb33-100"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-100" tabindex="-1"></a>    <span class="kw">def</span> _move_to_affordable_cell(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-101"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-101" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Move agent to an affordable empty cell if available.&quot;&quot;&quot;</span></span>
<span id="cb33-102"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-102" tabindex="-1"></a>        <span class="co"># Get affordable empty cells</span></span>
<span id="cb33-103"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-103" tabindex="-1"></a>        affordable_cells <span class="op">=</span> <span class="va">self</span>._get_affordable_empty_cells()</span>
<span id="cb33-104"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-104" tabindex="-1"></a></span>
<span id="cb33-105"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-105" tabindex="-1"></a>        <span class="cf">if</span> affordable_cells:</span>
<span id="cb33-106"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-106" tabindex="-1"></a>            <span class="co"># Choose random affordable cell</span></span>
<span id="cb33-107"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-107" tabindex="-1"></a>            new_pos <span class="op">=</span> <span class="va">self</span>.random.choice(affordable_cells)</span>
<span id="cb33-108"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-108" tabindex="-1"></a>            old_rent <span class="op">=</span> <span class="va">self</span>.model.rent_grid[<span class="va">self</span>.pos]</span>
<span id="cb33-109"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-109" tabindex="-1"></a>            new_rent <span class="op">=</span> <span class="va">self</span>.model.rent_grid[new_pos]</span>
<span id="cb33-110"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-110" tabindex="-1"></a></span>
<span id="cb33-111"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-111" tabindex="-1"></a>            <span class="co"># Pay moving cost</span></span>
<span id="cb33-112"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-112" tabindex="-1"></a>            <span class="va">self</span>.accumulated_wealth <span class="op">-=</span> <span class="va">self</span>.model.moving_cost</span>
<span id="cb33-113"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-113" tabindex="-1"></a></span>
<span id="cb33-114"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-114" tabindex="-1"></a>            <span class="co"># Move agent</span></span>
<span id="cb33-115"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-115" tabindex="-1"></a>            <span class="va">self</span>.model.grid.move_agent(<span class="va">self</span>, new_pos)</span>
<span id="cb33-116"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-116" tabindex="-1"></a>            <span class="va">self</span>.model.total_moves <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-117"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-117" tabindex="-1"></a></span>
<span id="cb33-118"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-118" tabindex="-1"></a>    <span class="kw">def</span> _get_affordable_empty_cells(<span class="va">self</span>) <span class="op">-&gt;</span> List[Tuple[<span class="bu">int</span>, <span class="bu">int</span>]]:</span>
<span id="cb33-119"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-119" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-120"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-120" tabindex="-1"></a><span class="co">        Get list of empty cells that agent can afford.</span></span>
<span id="cb33-121"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-121" tabindex="-1"></a><span class="co">        Agent can afford a cell if they have enough wealth for moving cost.</span></span>
<span id="cb33-122"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-122" tabindex="-1"></a></span>
<span id="cb33-123"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-123" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb33-124"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-124" tabindex="-1"></a><span class="co">            List of affordable empty cell coordinates</span></span>
<span id="cb33-125"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-125" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-126"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-126" tabindex="-1"></a>        affordable_cells <span class="op">=</span> []</span>
<span id="cb33-127"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-127" tabindex="-1"></a>        empty_cells <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>.model.grid.empties)</span>
<span id="cb33-128"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-128" tabindex="-1"></a></span>
<span id="cb33-129"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-129" tabindex="-1"></a>        <span class="co"># Agent needs enough wealth for moving cost</span></span>
<span id="cb33-130"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-130" tabindex="-1"></a>        available_wealth <span class="op">=</span> <span class="va">self</span>.accumulated_wealth <span class="op">-</span> <span class="va">self</span>.model.moving_cost</span>
<span id="cb33-131"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-131" tabindex="-1"></a></span>
<span id="cb33-132"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-132" tabindex="-1"></a>        <span class="cf">for</span> cell <span class="kw">in</span> empty_cells:</span>
<span id="cb33-133"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-133" tabindex="-1"></a>            rent <span class="op">=</span> <span class="va">self</span>.model.rent_grid[cell]</span>
<span id="cb33-134"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-134" tabindex="-1"></a>            <span class="co"># Agent can afford if rent is within their budget</span></span>
<span id="cb33-135"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-135" tabindex="-1"></a>            <span class="cf">if</span> available_wealth <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.income <span class="op">&gt;=</span> rent:</span>
<span id="cb33-136"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-136" tabindex="-1"></a>                affordable_cells.append(cell)</span>
<span id="cb33-137"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-137" tabindex="-1"></a></span>
<span id="cb33-138"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-138" tabindex="-1"></a>        <span class="cf">return</span> affordable_cells</span>
<span id="cb33-139"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-139" tabindex="-1"></a></span>
<span id="cb33-140"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-140" tabindex="-1"></a>    <span class="kw">def</span> earn_income(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-141"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-141" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Agent earns income and pays rent, adding net to accumulated wealth.&quot;&quot;&quot;</span></span>
<span id="cb33-142"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-142" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.pos <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb33-143"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-143" tabindex="-1"></a>            rent <span class="op">=</span> <span class="va">self</span>.model.rent_grid[<span class="va">self</span>.pos]</span>
<span id="cb33-144"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-144" tabindex="-1"></a>            net_income <span class="op">=</span> <span class="va">self</span>.income <span class="op">-</span> rent</span>
<span id="cb33-145"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-145" tabindex="-1"></a>            <span class="va">self</span>.accumulated_wealth <span class="op">+=</span> net_income</span>
<span id="cb33-146"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-146" tabindex="-1"></a>            <span class="co"># Prevent negative wealth</span></span>
<span id="cb33-147"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-147" tabindex="-1"></a>            <span class="va">self</span>.accumulated_wealth <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, <span class="va">self</span>.accumulated_wealth)</span>
<span id="cb33-148"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-148" tabindex="-1"></a></span>
<span id="cb33-149"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-149" tabindex="-1"></a></span>
<span id="cb33-150"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-150" tabindex="-1"></a><span class="kw">class</span> EconomicSchellingModel(Model):</span>
<span id="cb33-151"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-151" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-152"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-152" tabindex="-1"></a><span class="co">    Economic Schelling segregation model with income inequality between groups.</span></span>
<span id="cb33-153"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-153" tabindex="-1"></a><span class="co">    Minority agents have systematically lower income than majority agents.</span></span>
<span id="cb33-154"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-154" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb33-155"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-155" tabindex="-1"></a></span>
<span id="cb33-156"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-156" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb33-157"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-157" tabindex="-1"></a>        <span class="va">self</span>,</span>
<span id="cb33-158"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-158" tabindex="-1"></a>        width: <span class="bu">int</span> <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb33-159"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-159" tabindex="-1"></a>        height: <span class="bu">int</span> <span class="op">=</span> <span class="dv">20</span>,</span>
<span id="cb33-160"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-160" tabindex="-1"></a>        density: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span id="cb33-161"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-161" tabindex="-1"></a>        minority_pc: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb33-162"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-162" tabindex="-1"></a>        similarity_threshold: <span class="bu">float</span> <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span id="cb33-163"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-163" tabindex="-1"></a>        majority_base_income: <span class="bu">float</span> <span class="op">=</span> <span class="fl">15.0</span>,</span>
<span id="cb33-164"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-164" tabindex="-1"></a>        minority_base_income: <span class="bu">float</span> <span class="op">=</span> <span class="fl">8.0</span>,</span>
<span id="cb33-165"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-165" tabindex="-1"></a>        income_variance: <span class="bu">float</span> <span class="op">=</span> <span class="fl">3.0</span>,</span>
<span id="cb33-166"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-166" tabindex="-1"></a>        rent_distribution: <span class="bu">str</span> <span class="op">=</span> <span class="st">&#39;uniform&#39;</span>,</span>
<span id="cb33-167"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-167" tabindex="-1"></a>        base_rent: <span class="bu">float</span> <span class="op">=</span> <span class="fl">2.0</span>,</span>
<span id="cb33-168"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-168" tabindex="-1"></a>        rent_variance: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span id="cb33-169"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-169" tabindex="-1"></a>        moving_cost: <span class="bu">float</span> <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span id="cb33-170"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-170" tabindex="-1"></a>        income_distribution: <span class="bu">str</span> <span class="op">=</span> <span class="st">&#39;normal&#39;</span></span>
<span id="cb33-171"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-171" tabindex="-1"></a>    ):</span>
<span id="cb33-172"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-172" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-173"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-173" tabindex="-1"></a><span class="co">        Initialize the Economic Schelling model with income inequality.</span></span>
<span id="cb33-174"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-174" tabindex="-1"></a></span>
<span id="cb33-175"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-175" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb33-176"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-176" tabindex="-1"></a><span class="co">            width: Width of the grid</span></span>
<span id="cb33-177"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-177" tabindex="-1"></a><span class="co">            height: Height of the grid</span></span>
<span id="cb33-178"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-178" tabindex="-1"></a><span class="co">            density: Proportion of cells occupied by agents (0-1)</span></span>
<span id="cb33-179"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-179" tabindex="-1"></a><span class="co">            minority_pc: Proportion of minority agents (0-1)</span></span>
<span id="cb33-180"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-180" tabindex="-1"></a><span class="co">            similarity_threshold: Minimum similarity ratio for happiness (0-1)</span></span>
<span id="cb33-181"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-181" tabindex="-1"></a><span class="co">            majority_base_income: Base income for majority agents</span></span>
<span id="cb33-182"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-182" tabindex="-1"></a><span class="co">            minority_base_income: Base income for minority agents</span></span>
<span id="cb33-183"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-183" tabindex="-1"></a><span class="co">            income_variance: Variance in income distribution</span></span>
<span id="cb33-184"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-184" tabindex="-1"></a><span class="co">            rent_distribution: Distribution of rent prices (&#39;uniform&#39;, &#39;gradient&#39;, or &#39;normal&#39;)</span></span>
<span id="cb33-185"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-185" tabindex="-1"></a><span class="co">            base_rent: Base rent level for cells</span></span>
<span id="cb33-186"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-186" tabindex="-1"></a><span class="co">            rent_variance: Variance in rent distribution</span></span>
<span id="cb33-187"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-187" tabindex="-1"></a><span class="co">            moving_cost: Cost of moving to a new location</span></span>
<span id="cb33-188"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-188" tabindex="-1"></a><span class="co">            income_distribution: Distribution type (&#39;uniform&#39; or &#39;normal&#39;)</span></span>
<span id="cb33-189"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-189" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-190"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-190" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb33-191"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-191" tabindex="-1"></a></span>
<span id="cb33-192"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-192" tabindex="-1"></a>        <span class="co"># Validate parameters</span></span>
<span id="cb33-193"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-193" tabindex="-1"></a>        <span class="va">self</span>._validate_parameters(width, height, density, minority_pc, similarity_threshold)</span>
<span id="cb33-194"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-194" tabindex="-1"></a></span>
<span id="cb33-195"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-195" tabindex="-1"></a>        <span class="co"># Model parameters</span></span>
<span id="cb33-196"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-196" tabindex="-1"></a>        <span class="va">self</span>.width <span class="op">=</span> width</span>
<span id="cb33-197"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-197" tabindex="-1"></a>        <span class="va">self</span>.height <span class="op">=</span> height</span>
<span id="cb33-198"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-198" tabindex="-1"></a>        <span class="va">self</span>.density <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, <span class="bu">min</span>(<span class="fl">1.0</span>, density))  <span class="co"># Clamp between 0 and 1</span></span>
<span id="cb33-199"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-199" tabindex="-1"></a>        <span class="va">self</span>.minority_pc <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, <span class="bu">min</span>(<span class="fl">1.0</span>, minority_pc))  <span class="co"># Clamp between 0 and 1</span></span>
<span id="cb33-200"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-200" tabindex="-1"></a>        <span class="va">self</span>.similarity_threshold <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, <span class="bu">min</span>(<span class="fl">1.0</span>, similarity_threshold))</span>
<span id="cb33-201"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-201" tabindex="-1"></a>        <span class="va">self</span>.majority_base_income <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, majority_base_income)</span>
<span id="cb33-202"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-202" tabindex="-1"></a>        <span class="va">self</span>.minority_base_income <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, minority_base_income)</span>
<span id="cb33-203"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-203" tabindex="-1"></a>        <span class="va">self</span>.income_variance <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, income_variance)</span>
<span id="cb33-204"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-204" tabindex="-1"></a>        <span class="va">self</span>.rent_distribution <span class="op">=</span> rent_distribution</span>
<span id="cb33-205"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-205" tabindex="-1"></a>        <span class="va">self</span>.base_rent <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, base_rent)</span>
<span id="cb33-206"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-206" tabindex="-1"></a>        <span class="va">self</span>.rent_variance <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, rent_variance)</span>
<span id="cb33-207"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-207" tabindex="-1"></a>        <span class="va">self</span>.moving_cost <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, moving_cost)</span>
<span id="cb33-208"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-208" tabindex="-1"></a>        <span class="va">self</span>.income_distribution <span class="op">=</span> income_distribution</span>
<span id="cb33-209"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-209" tabindex="-1"></a></span>
<span id="cb33-210"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-210" tabindex="-1"></a>        <span class="co"># Initialize model components</span></span>
<span id="cb33-211"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-211" tabindex="-1"></a>        <span class="va">self</span>.grid <span class="op">=</span> MultiGrid(width, height, torus<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-212"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-212" tabindex="-1"></a>        <span class="va">self</span>.schedule <span class="op">=</span> RandomActivation(<span class="va">self</span>)</span>
<span id="cb33-213"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-213" tabindex="-1"></a></span>
<span id="cb33-214"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-214" tabindex="-1"></a>        <span class="co"># Initialize rent grid</span></span>
<span id="cb33-215"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-215" tabindex="-1"></a>        <span class="va">self</span>.rent_grid <span class="op">=</span> <span class="va">self</span>._create_rent_grid()</span>
<span id="cb33-216"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-216" tabindex="-1"></a></span>
<span id="cb33-217"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-217" tabindex="-1"></a>        <span class="co"># Data collection</span></span>
<span id="cb33-218"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-218" tabindex="-1"></a>        <span class="va">self</span>.datacollector <span class="op">=</span> DataCollector(</span>
<span id="cb33-219"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-219" tabindex="-1"></a>            model_reporters<span class="op">=</span>{</span>
<span id="cb33-220"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-220" tabindex="-1"></a>                <span class="st">&quot;Segregation&quot;</span>: <span class="va">self</span>.calculate_segregation,</span>
<span id="cb33-221"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-221" tabindex="-1"></a>                <span class="st">&quot;Total_Moves&quot;</span>: <span class="kw">lambda</span> m: m.total_moves,</span>
<span id="cb33-222"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-222" tabindex="-1"></a>                <span class="st">&quot;Avg_Income_Majority&quot;</span>: <span class="kw">lambda</span> m: <span class="va">self</span>._calculate_avg_income(AgentType.MAJORITY),</span>
<span id="cb33-223"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-223" tabindex="-1"></a>                <span class="st">&quot;Avg_Income_Minority&quot;</span>: <span class="kw">lambda</span> m: <span class="va">self</span>._calculate_avg_income(AgentType.MINORITY),</span>
<span id="cb33-224"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-224" tabindex="-1"></a>                <span class="st">&quot;Avg_Wealth_Majority&quot;</span>: <span class="kw">lambda</span> m: <span class="va">self</span>._calculate_avg_wealth(AgentType.MAJORITY),</span>
<span id="cb33-225"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-225" tabindex="-1"></a>                <span class="st">&quot;Avg_Wealth_Minority&quot;</span>: <span class="kw">lambda</span> m: <span class="va">self</span>._calculate_avg_wealth(AgentType.MINORITY),</span>
<span id="cb33-226"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-226" tabindex="-1"></a>                <span class="st">&quot;Avg_Rent_Occupied&quot;</span>: <span class="va">self</span>._calculate_avg_rent_occupied,</span>
<span id="cb33-227"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-227" tabindex="-1"></a>                <span class="st">&quot;Economic_Segregation&quot;</span>: <span class="va">self</span>.calculate_economic_segregation,</span>
<span id="cb33-228"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-228" tabindex="-1"></a>                <span class="st">&quot;Income_Inequality_Ratio&quot;</span>: <span class="va">self</span>.calculate_income_inequality_ratio,</span>
<span id="cb33-229"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-229" tabindex="-1"></a>                <span class="st">&quot;Unhappy_Agents&quot;</span>: <span class="va">self</span>.count_unhappy_agents,</span>
<span id="cb33-230"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-230" tabindex="-1"></a>                <span class="st">&quot;Empty_Cells&quot;</span>: <span class="kw">lambda</span> m: <span class="bu">len</span>(<span class="bu">list</span>(m.grid.empties))</span>
<span id="cb33-231"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-231" tabindex="-1"></a>            },</span>
<span id="cb33-232"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-232" tabindex="-1"></a>            agent_reporters<span class="op">=</span>{</span>
<span id="cb33-233"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-233" tabindex="-1"></a>                <span class="st">&quot;Wealth&quot;</span>: <span class="st">&quot;accumulated_wealth&quot;</span>,</span>
<span id="cb33-234"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-234" tabindex="-1"></a>                <span class="st">&quot;Income&quot;</span>: <span class="st">&quot;income&quot;</span>,</span>
<span id="cb33-235"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-235" tabindex="-1"></a>                <span class="st">&quot;Type&quot;</span>: <span class="st">&quot;type&quot;</span>,</span>
<span id="cb33-236"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-236" tabindex="-1"></a>                <span class="st">&quot;Position_X&quot;</span>: <span class="kw">lambda</span> a: a.pos[<span class="dv">0</span>] <span class="cf">if</span> a.pos <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb33-237"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-237" tabindex="-1"></a>                <span class="st">&quot;Position_Y&quot;</span>: <span class="kw">lambda</span> a: a.pos[<span class="dv">1</span>] <span class="cf">if</span> a.pos <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb33-238"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-238" tabindex="-1"></a>            }</span>
<span id="cb33-239"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-239" tabindex="-1"></a>        )</span>
<span id="cb33-240"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-240" tabindex="-1"></a></span>
<span id="cb33-241"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-241" tabindex="-1"></a>        <span class="co"># Initialize agents</span></span>
<span id="cb33-242"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-242" tabindex="-1"></a>        <span class="va">self</span>._place_agents()</span>
<span id="cb33-243"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-243" tabindex="-1"></a></span>
<span id="cb33-244"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-244" tabindex="-1"></a>        <span class="co"># Track metrics</span></span>
<span id="cb33-245"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-245" tabindex="-1"></a>        <span class="va">self</span>.total_moves <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-246"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-246" tabindex="-1"></a></span>
<span id="cb33-247"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-247" tabindex="-1"></a>        logger.info(<span class="ss">f&quot;Model initialized: </span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.schedule.agents)<span class="sc">}</span><span class="ss"> agents on </span><span class="sc">{</span>width<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>height<span class="sc">}</span><span class="ss"> grid&quot;</span>)</span>
<span id="cb33-248"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-248" tabindex="-1"></a></span>
<span id="cb33-249"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-249" tabindex="-1"></a>    <span class="kw">def</span> _validate_parameters(<span class="va">self</span>, width: <span class="bu">int</span>, height: <span class="bu">int</span>, density: <span class="bu">float</span>,</span>
<span id="cb33-250"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-250" tabindex="-1"></a>                           minority_pc: <span class="bu">float</span>, similarity_threshold: <span class="bu">float</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-251"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-251" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Validate model parameters and raise errors for invalid values.&quot;&quot;&quot;</span></span>
<span id="cb33-252"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-252" tabindex="-1"></a>        <span class="cf">if</span> width <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">or</span> height <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb33-253"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-253" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Width and height must be positive integers&quot;</span>)</span>
<span id="cb33-254"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-254" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="dv">0</span> <span class="op">&lt;=</span> density <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb33-255"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-255" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Density must be between 0 and 1&quot;</span>)</span>
<span id="cb33-256"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-256" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="dv">0</span> <span class="op">&lt;=</span> minority_pc <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb33-257"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-257" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Minority percentage must be between 0 and 1&quot;</span>)</span>
<span id="cb33-258"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-258" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="dv">0</span> <span class="op">&lt;=</span> similarity_threshold <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb33-259"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-259" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;Similarity threshold must be between 0 and 1&quot;</span>)</span>
<span id="cb33-260"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-260" tabindex="-1"></a></span>
<span id="cb33-261"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-261" tabindex="-1"></a>    <span class="kw">def</span> _create_rent_grid(<span class="va">self</span>) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb33-262"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-262" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-263"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-263" tabindex="-1"></a><span class="co">        Create rent grid based on specified distribution.</span></span>
<span id="cb33-264"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-264" tabindex="-1"></a></span>
<span id="cb33-265"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-265" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb33-266"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-266" tabindex="-1"></a><span class="co">            2D numpy array of rent prices (all non-negative)</span></span>
<span id="cb33-267"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-267" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-268"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-268" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.rent_distribution <span class="op">==</span> <span class="st">&#39;uniform&#39;</span>:</span>
<span id="cb33-269"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-269" tabindex="-1"></a>            rent_grid <span class="op">=</span> np.random.uniform(</span>
<span id="cb33-270"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-270" tabindex="-1"></a>                <span class="bu">max</span>(<span class="fl">0.0</span>, <span class="va">self</span>.base_rent <span class="op">-</span> <span class="va">self</span>.rent_variance),</span>
<span id="cb33-271"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-271" tabindex="-1"></a>                <span class="va">self</span>.base_rent <span class="op">+</span> <span class="va">self</span>.rent_variance,</span>
<span id="cb33-272"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-272" tabindex="-1"></a>                (<span class="va">self</span>.width, <span class="va">self</span>.height)</span>
<span id="cb33-273"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-273" tabindex="-1"></a>            )</span>
<span id="cb33-274"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-274" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.rent_distribution <span class="op">==</span> <span class="st">&#39;gradient&#39;</span>:</span>
<span id="cb33-275"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-275" tabindex="-1"></a>            <span class="co"># Create gradient from low rent (top-left) to high rent (bottom-right)</span></span>
<span id="cb33-276"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-276" tabindex="-1"></a>            rent_grid <span class="op">=</span> np.zeros((<span class="va">self</span>.width, <span class="va">self</span>.height))</span>
<span id="cb33-277"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-277" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.width):</span>
<span id="cb33-278"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-278" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.height):</span>
<span id="cb33-279"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-279" tabindex="-1"></a>                    <span class="co"># Linear gradient based on distance from origin</span></span>
<span id="cb33-280"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-280" tabindex="-1"></a>                    normalized_distance <span class="op">=</span> (i <span class="op">+</span> j) <span class="op">/</span> (<span class="va">self</span>.width <span class="op">+</span> <span class="va">self</span>.height <span class="op">-</span> <span class="dv">2</span>)</span>
<span id="cb33-281"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-281" tabindex="-1"></a>                    rent_value <span class="op">=</span> <span class="va">self</span>.base_rent <span class="op">+</span> (normalized_distance <span class="op">*</span> <span class="va">self</span>.rent_variance <span class="op">*</span> <span class="dv">2</span>) <span class="op">-</span> <span class="va">self</span>.rent_variance</span>
<span id="cb33-282"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-282" tabindex="-1"></a>                    rent_grid[i, j] <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, rent_value)  <span class="co"># Ensure non-negative</span></span>
<span id="cb33-283"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-283" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.rent_distribution <span class="op">==</span> <span class="st">&#39;normal&#39;</span>:</span>
<span id="cb33-284"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-284" tabindex="-1"></a>            rent_grid <span class="op">=</span> np.random.normal(<span class="va">self</span>.base_rent, <span class="va">self</span>.rent_variance, (<span class="va">self</span>.width, <span class="va">self</span>.height))</span>
<span id="cb33-285"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-285" tabindex="-1"></a>            rent_grid <span class="op">=</span> np.maximum(rent_grid, <span class="fl">0.0</span>)  <span class="co"># Ensure all rents are non-negative</span></span>
<span id="cb33-286"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-286" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb33-287"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-287" tabindex="-1"></a>            <span class="co"># Default to uniform base rent</span></span>
<span id="cb33-288"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-288" tabindex="-1"></a>            rent_grid <span class="op">=</span> np.full((<span class="va">self</span>.width, <span class="va">self</span>.height), <span class="va">self</span>.base_rent)</span>
<span id="cb33-289"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-289" tabindex="-1"></a></span>
<span id="cb33-290"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-290" tabindex="-1"></a>        <span class="cf">return</span> rent_grid</span>
<span id="cb33-291"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-291" tabindex="-1"></a></span>
<span id="cb33-292"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-292" tabindex="-1"></a>    <span class="kw">def</span> _place_agents(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-293"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-293" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Place agents randomly on the grid with proper density control.&quot;&quot;&quot;</span></span>
<span id="cb33-294"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-294" tabindex="-1"></a>        total_cells <span class="op">=</span> <span class="va">self</span>.width <span class="op">*</span> <span class="va">self</span>.height</span>
<span id="cb33-295"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-295" tabindex="-1"></a>        num_agents <span class="op">=</span> <span class="bu">int</span>(total_cells <span class="op">*</span> <span class="va">self</span>.density)</span>
<span id="cb33-296"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-296" tabindex="-1"></a></span>
<span id="cb33-297"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-297" tabindex="-1"></a>        <span class="co"># Generate all possible positions and shuffle them</span></span>
<span id="cb33-298"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-298" tabindex="-1"></a>        all_positions <span class="op">=</span> [(x, y) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.width) <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.height)]</span>
<span id="cb33-299"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-299" tabindex="-1"></a>        <span class="va">self</span>.random.shuffle(all_positions)</span>
<span id="cb33-300"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-300" tabindex="-1"></a></span>
<span id="cb33-301"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-301" tabindex="-1"></a>        agent_id <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-302"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-302" tabindex="-1"></a></span>
<span id="cb33-303"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-303" tabindex="-1"></a>        <span class="co"># Place agents in the first num_agents positions</span></span>
<span id="cb33-304"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-304" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(num_agents, <span class="bu">len</span>(all_positions))):</span>
<span id="cb33-305"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-305" tabindex="-1"></a>            pos <span class="op">=</span> all_positions[i]</span>
<span id="cb33-306"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-306" tabindex="-1"></a></span>
<span id="cb33-307"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-307" tabindex="-1"></a>            <span class="co"># Determine agent type</span></span>
<span id="cb33-308"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-308" tabindex="-1"></a>            agent_type <span class="op">=</span> AgentType.MINORITY <span class="cf">if</span> <span class="va">self</span>.random.random() <span class="op">&lt;</span> <span class="va">self</span>.minority_pc <span class="cf">else</span> AgentType.MAJORITY</span>
<span id="cb33-309"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-309" tabindex="-1"></a></span>
<span id="cb33-310"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-310" tabindex="-1"></a>            <span class="co"># Generate income</span></span>
<span id="cb33-311"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-311" tabindex="-1"></a>            income <span class="op">=</span> <span class="va">self</span>._generate_income(agent_type)</span>
<span id="cb33-312"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-312" tabindex="-1"></a></span>
<span id="cb33-313"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-313" tabindex="-1"></a>            <span class="co"># Create and place agent</span></span>
<span id="cb33-314"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-314" tabindex="-1"></a>            agent <span class="op">=</span> EconomicSchellingAgent(agent_id, <span class="va">self</span>, agent_type, income)</span>
<span id="cb33-315"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-315" tabindex="-1"></a>            <span class="va">self</span>.grid.place_agent(agent, pos)</span>
<span id="cb33-316"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-316" tabindex="-1"></a>            <span class="va">self</span>.schedule.add(agent)</span>
<span id="cb33-317"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-317" tabindex="-1"></a>            agent_id <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-318"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-318" tabindex="-1"></a></span>
<span id="cb33-319"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-319" tabindex="-1"></a>    <span class="kw">def</span> _generate_income(<span class="va">self</span>, agent_type: AgentType) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb33-320"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-320" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-321"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-321" tabindex="-1"></a><span class="co">        Generate income for an agent based on type with systematic inequality.</span></span>
<span id="cb33-322"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-322" tabindex="-1"></a></span>
<span id="cb33-323"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-323" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb33-324"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-324" tabindex="-1"></a><span class="co">            agent_type: Type of agent</span></span>
<span id="cb33-325"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-325" tabindex="-1"></a></span>
<span id="cb33-326"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-326" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb33-327"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-327" tabindex="-1"></a><span class="co">            Generated income level (always non-negative)</span></span>
<span id="cb33-328"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-328" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-329"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-329" tabindex="-1"></a>        base_income <span class="op">=</span> (<span class="va">self</span>.majority_base_income <span class="cf">if</span> agent_type <span class="op">==</span> AgentType.MAJORITY</span>
<span id="cb33-330"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-330" tabindex="-1"></a>                      <span class="cf">else</span> <span class="va">self</span>.minority_base_income)</span>
<span id="cb33-331"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-331" tabindex="-1"></a></span>
<span id="cb33-332"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-332" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.income_distribution <span class="op">==</span> <span class="st">&#39;uniform&#39;</span>:</span>
<span id="cb33-333"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-333" tabindex="-1"></a>            income <span class="op">=</span> np.random.uniform(</span>
<span id="cb33-334"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-334" tabindex="-1"></a>                <span class="bu">max</span>(<span class="fl">0.0</span>, base_income <span class="op">-</span> <span class="va">self</span>.income_variance),</span>
<span id="cb33-335"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-335" tabindex="-1"></a>                base_income <span class="op">+</span> <span class="va">self</span>.income_variance</span>
<span id="cb33-336"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-336" tabindex="-1"></a>            )</span>
<span id="cb33-337"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-337" tabindex="-1"></a>        <span class="cf">elif</span> <span class="va">self</span>.income_distribution <span class="op">==</span> <span class="st">&#39;normal&#39;</span>:</span>
<span id="cb33-338"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-338" tabindex="-1"></a>            income <span class="op">=</span> np.random.normal(base_income, <span class="va">self</span>.income_variance)</span>
<span id="cb33-339"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-339" tabindex="-1"></a>            income <span class="op">=</span> <span class="bu">max</span>(<span class="fl">0.0</span>, income)  <span class="co"># Ensure non-negative</span></span>
<span id="cb33-340"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-340" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb33-341"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-341" tabindex="-1"></a>            income <span class="op">=</span> base_income</span>
<span id="cb33-342"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-342" tabindex="-1"></a></span>
<span id="cb33-343"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-343" tabindex="-1"></a>        <span class="cf">return</span> income</span>
<span id="cb33-344"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-344" tabindex="-1"></a></span>
<span id="cb33-345"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-345" tabindex="-1"></a>    <span class="kw">def</span> _calculate_avg_income(<span class="va">self</span>, agent_type: AgentType) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb33-346"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-346" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Calculate average income for a specific agent type.&quot;&quot;&quot;</span></span>
<span id="cb33-347"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-347" tabindex="-1"></a>        incomes <span class="op">=</span> [agent.income <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents</span>
<span id="cb33-348"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-348" tabindex="-1"></a>                  <span class="cf">if</span> agent.<span class="bu">type</span> <span class="op">==</span> agent_type]</span>
<span id="cb33-349"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-349" tabindex="-1"></a>        <span class="cf">return</span> np.mean(incomes) <span class="cf">if</span> incomes <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb33-350"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-350" tabindex="-1"></a></span>
<span id="cb33-351"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-351" tabindex="-1"></a>    <span class="kw">def</span> _calculate_avg_wealth(<span class="va">self</span>, agent_type: AgentType) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb33-352"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-352" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Calculate average wealth for a specific agent type.&quot;&quot;&quot;</span></span>
<span id="cb33-353"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-353" tabindex="-1"></a>        wealth <span class="op">=</span> [agent.accumulated_wealth <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents</span>
<span id="cb33-354"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-354" tabindex="-1"></a>                 <span class="cf">if</span> agent.<span class="bu">type</span> <span class="op">==</span> agent_type]</span>
<span id="cb33-355"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-355" tabindex="-1"></a>        <span class="cf">return</span> np.mean(wealth) <span class="cf">if</span> wealth <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb33-356"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-356" tabindex="-1"></a></span>
<span id="cb33-357"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-357" tabindex="-1"></a>    <span class="kw">def</span> _calculate_avg_rent_occupied(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb33-358"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-358" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Calculate average rent of occupied cells.&quot;&quot;&quot;</span></span>
<span id="cb33-359"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-359" tabindex="-1"></a>        occupied_rents <span class="op">=</span> []</span>
<span id="cb33-360"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-360" tabindex="-1"></a>        <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents:</span>
<span id="cb33-361"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-361" tabindex="-1"></a>            <span class="cf">if</span> agent.pos:</span>
<span id="cb33-362"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-362" tabindex="-1"></a>                occupied_rents.append(<span class="va">self</span>.rent_grid[agent.pos])</span>
<span id="cb33-363"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-363" tabindex="-1"></a>        <span class="cf">return</span> np.mean(occupied_rents) <span class="cf">if</span> occupied_rents <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb33-364"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-364" tabindex="-1"></a></span>
<span id="cb33-365"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-365" tabindex="-1"></a>    <span class="kw">def</span> calculate_segregation(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb33-366"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-366" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-367"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-367" tabindex="-1"></a><span class="co">        Calculate the average proportion of similar neighbors across all agents.</span></span>
<span id="cb33-368"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-368" tabindex="-1"></a></span>
<span id="cb33-369"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-369" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb33-370"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-370" tabindex="-1"></a><span class="co">            Average similarity ratio (0-1)</span></span>
<span id="cb33-371"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-371" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-372"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-372" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.schedule.agents:</span>
<span id="cb33-373"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-373" tabindex="-1"></a>            <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb33-374"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-374" tabindex="-1"></a></span>
<span id="cb33-375"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-375" tabindex="-1"></a>        total_similar <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-376"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-376" tabindex="-1"></a>        total_neighbors <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-377"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-377" tabindex="-1"></a></span>
<span id="cb33-378"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-378" tabindex="-1"></a>        <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents:</span>
<span id="cb33-379"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-379" tabindex="-1"></a>            <span class="cf">if</span> agent.pos <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb33-380"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-380" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb33-381"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-381" tabindex="-1"></a></span>
<span id="cb33-382"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-382" tabindex="-1"></a>            neighbors <span class="op">=</span> <span class="va">self</span>.grid.get_neighbors(</span>
<span id="cb33-383"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-383" tabindex="-1"></a>                agent.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span></span>
<span id="cb33-384"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-384" tabindex="-1"></a>            )</span>
<span id="cb33-385"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-385" tabindex="-1"></a></span>
<span id="cb33-386"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-386" tabindex="-1"></a>            <span class="cf">if</span> neighbors:</span>
<span id="cb33-387"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-387" tabindex="-1"></a>                similar <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors <span class="cf">if</span> neighbor.<span class="bu">type</span> <span class="op">==</span> agent.<span class="bu">type</span>)</span>
<span id="cb33-388"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-388" tabindex="-1"></a>                total_similar <span class="op">+=</span> similar</span>
<span id="cb33-389"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-389" tabindex="-1"></a>                total_neighbors <span class="op">+=</span> <span class="bu">len</span>(neighbors)</span>
<span id="cb33-390"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-390" tabindex="-1"></a></span>
<span id="cb33-391"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-391" tabindex="-1"></a>        <span class="cf">return</span> total_similar <span class="op">/</span> total_neighbors <span class="cf">if</span> total_neighbors <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb33-392"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-392" tabindex="-1"></a></span>
<span id="cb33-393"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-393" tabindex="-1"></a>    <span class="kw">def</span> calculate_economic_segregation(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb33-394"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-394" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-395"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-395" tabindex="-1"></a><span class="co">        Calculate economic segregation by income similarity of neighbors.</span></span>
<span id="cb33-396"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-396" tabindex="-1"></a></span>
<span id="cb33-397"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-397" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb33-398"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-398" tabindex="-1"></a><span class="co">            Average income similarity ratio (0-1)</span></span>
<span id="cb33-399"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-399" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-400"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-400" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.schedule.agents:</span>
<span id="cb33-401"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-401" tabindex="-1"></a>            <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb33-402"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-402" tabindex="-1"></a></span>
<span id="cb33-403"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-403" tabindex="-1"></a>        total_similarity <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-404"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-404" tabindex="-1"></a>        total_comparisons <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-405"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-405" tabindex="-1"></a></span>
<span id="cb33-406"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-406" tabindex="-1"></a>        <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents:</span>
<span id="cb33-407"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-407" tabindex="-1"></a>            <span class="cf">if</span> agent.pos <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb33-408"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-408" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb33-409"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-409" tabindex="-1"></a></span>
<span id="cb33-410"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-410" tabindex="-1"></a>            neighbors <span class="op">=</span> <span class="va">self</span>.grid.get_neighbors(</span>
<span id="cb33-411"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-411" tabindex="-1"></a>                agent.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span></span>
<span id="cb33-412"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-412" tabindex="-1"></a>            )</span>
<span id="cb33-413"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-413" tabindex="-1"></a></span>
<span id="cb33-414"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-414" tabindex="-1"></a>            <span class="cf">if</span> neighbors:</span>
<span id="cb33-415"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-415" tabindex="-1"></a>                agent_income <span class="op">=</span> agent.income</span>
<span id="cb33-416"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-416" tabindex="-1"></a>                <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors:</span>
<span id="cb33-417"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-417" tabindex="-1"></a>                    <span class="co"># Calculate similarity between agent and each neighbor</span></span>
<span id="cb33-418"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-418" tabindex="-1"></a>                    max_income <span class="op">=</span> <span class="bu">max</span>(agent_income, neighbor.income)</span>
<span id="cb33-419"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-419" tabindex="-1"></a>                    <span class="cf">if</span> max_income <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-420"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-420" tabindex="-1"></a>                        similarity <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="bu">abs</span>(agent_income <span class="op">-</span> neighbor.income) <span class="op">/</span> max_income)</span>
<span id="cb33-421"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-421" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb33-422"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-422" tabindex="-1"></a>                        similarity <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb33-423"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-423" tabindex="-1"></a></span>
<span id="cb33-424"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-424" tabindex="-1"></a>                    total_similarity <span class="op">+=</span> similarity</span>
<span id="cb33-425"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-425" tabindex="-1"></a>                    total_comparisons <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-426"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-426" tabindex="-1"></a></span>
<span id="cb33-427"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-427" tabindex="-1"></a>        <span class="cf">return</span> total_similarity <span class="op">/</span> total_comparisons <span class="cf">if</span> total_comparisons <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb33-428"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-428" tabindex="-1"></a></span>
<span id="cb33-429"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-429" tabindex="-1"></a>    <span class="kw">def</span> calculate_income_inequality_ratio(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb33-430"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-430" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-431"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-431" tabindex="-1"></a><span class="co">        Calculate the income inequality ratio between majority and minority groups.</span></span>
<span id="cb33-432"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-432" tabindex="-1"></a></span>
<span id="cb33-433"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-433" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb33-434"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-434" tabindex="-1"></a><span class="co">            Ratio of average majority income to average minority income</span></span>
<span id="cb33-435"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-435" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb33-436"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-436" tabindex="-1"></a>        avg_majority_income <span class="op">=</span> <span class="va">self</span>._calculate_avg_income(AgentType.MAJORITY)</span>
<span id="cb33-437"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-437" tabindex="-1"></a>        avg_minority_income <span class="op">=</span> <span class="va">self</span>._calculate_avg_income(AgentType.MINORITY)</span>
<span id="cb33-438"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-438" tabindex="-1"></a></span>
<span id="cb33-439"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-439" tabindex="-1"></a>        <span class="cf">if</span> avg_minority_income <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb33-440"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-440" tabindex="-1"></a>            <span class="cf">return</span> avg_majority_income <span class="op">/</span> avg_minority_income</span>
<span id="cb33-441"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-441" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb33-442"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-442" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">float</span>(<span class="st">&#39;inf&#39;</span>) <span class="cf">if</span> avg_majority_income <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">1.0</span></span>
<span id="cb33-443"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-443" tabindex="-1"></a></span>
<span id="cb33-444"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-444" tabindex="-1"></a>    <span class="kw">def</span> count_unhappy_agents(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">int</span>:</span>
<span id="cb33-445"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-445" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Count the number of unhappy agents in the model.&quot;&quot;&quot;</span></span>
<span id="cb33-446"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-446" tabindex="-1"></a>        unhappy_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb33-447"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-447" tabindex="-1"></a></span>
<span id="cb33-448"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-448" tabindex="-1"></a>        <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents:</span>
<span id="cb33-449"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-449" tabindex="-1"></a>            <span class="cf">if</span> agent.pos <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb33-450"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-450" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb33-451"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-451" tabindex="-1"></a></span>
<span id="cb33-452"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-452" tabindex="-1"></a>            neighbors <span class="op">=</span> <span class="va">self</span>.grid.get_neighbors(</span>
<span id="cb33-453"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-453" tabindex="-1"></a>                agent.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span></span>
<span id="cb33-454"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-454" tabindex="-1"></a>            )</span>
<span id="cb33-455"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-455" tabindex="-1"></a></span>
<span id="cb33-456"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-456" tabindex="-1"></a>            <span class="cf">if</span> neighbors:</span>
<span id="cb33-457"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-457" tabindex="-1"></a>                similar <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors <span class="cf">if</span> neighbor.<span class="bu">type</span> <span class="op">==</span> agent.<span class="bu">type</span>)</span>
<span id="cb33-458"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-458" tabindex="-1"></a>                similarity_ratio <span class="op">=</span> similar <span class="op">/</span> <span class="bu">len</span>(neighbors)</span>
<span id="cb33-459"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-459" tabindex="-1"></a>                <span class="cf">if</span> similarity_ratio <span class="op">&lt;</span> agent.happiness_threshold:</span>
<span id="cb33-460"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-460" tabindex="-1"></a>                    unhappy_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb33-461"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-461" tabindex="-1"></a></span>
<span id="cb33-462"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-462" tabindex="-1"></a>        <span class="cf">return</span> unhappy_count</span>
<span id="cb33-463"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-463" tabindex="-1"></a></span>
<span id="cb33-464"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-464" tabindex="-1"></a>    <span class="kw">def</span> step(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-465"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-465" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Execute one step of the model.&quot;&quot;&quot;</span></span>
<span id="cb33-466"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-466" tabindex="-1"></a>        <span class="co"># Agents earn income and pay rent</span></span>
<span id="cb33-467"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-467" tabindex="-1"></a>        <span class="cf">for</span> agent <span class="kw">in</span> <span class="va">self</span>.schedule.agents:</span>
<span id="cb33-468"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-468" tabindex="-1"></a>            agent.earn_income()</span>
<span id="cb33-469"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-469" tabindex="-1"></a></span>
<span id="cb33-470"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-470" tabindex="-1"></a>        <span class="co"># Collect data before agent movement</span></span>
<span id="cb33-471"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-471" tabindex="-1"></a>        <span class="va">self</span>.datacollector.collect(<span class="va">self</span>)</span>
<span id="cb33-472"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-472" tabindex="-1"></a></span>
<span id="cb33-473"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-473" tabindex="-1"></a>        <span class="co"># Execute agent steps (movement decisions)</span></span>
<span id="cb33-474"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-474" tabindex="-1"></a>        <span class="va">self</span>.schedule.step()</span>
<span id="cb33-475"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-475" tabindex="-1"></a></span>
<span id="cb33-476"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-476" tabindex="-1"></a></span>
<span id="cb33-477"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-477" tabindex="-1"></a><span class="kw">class</span> EconomicSchellingVisualizer:</span>
<span id="cb33-478"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-478" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Enhanced visualization for the Economic Schelling model.&quot;&quot;&quot;</span></span>
<span id="cb33-479"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-479" tabindex="-1"></a></span>
<span id="cb33-480"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-480" tabindex="-1"></a>    <span class="co"># Improved color schemes</span></span>
<span id="cb33-481"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-481" tabindex="-1"></a>    SOCIAL_COLORS <span class="op">=</span> {<span class="st">&#39;Empty&#39;</span>: <span class="st">&#39;white&#39;</span>, <span class="st">&#39;Majority&#39;</span>: <span class="st">&#39;#1f77b4&#39;</span>, <span class="st">&#39;Minority&#39;</span>: <span class="st">&#39;#ff7f0e&#39;</span>}</span>
<span id="cb33-482"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-482" tabindex="-1"></a></span>
<span id="cb33-483"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-483" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb33-484"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-484" tabindex="-1"></a>    <span class="kw">def</span> extract_social_grid(model: EconomicSchellingModel) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb33-485"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-485" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Extract social grid state for visualization.&quot;&quot;&quot;</span></span>
<span id="cb33-486"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-486" tabindex="-1"></a>        grid <span class="op">=</span> np.zeros((model.width, model.height))</span>
<span id="cb33-487"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-487" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(model.width):</span>
<span id="cb33-488"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-488" tabindex="-1"></a>            <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(model.height):</span>
<span id="cb33-489"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-489" tabindex="-1"></a>                agents <span class="op">=</span> model.grid.get_cell_list_contents([(x, y)])</span>
<span id="cb33-490"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-490" tabindex="-1"></a>                <span class="cf">if</span> agents:</span>
<span id="cb33-491"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-491" tabindex="-1"></a>                    grid[x, y] <span class="op">=</span> agents[<span class="dv">0</span>].<span class="bu">type</span>.value <span class="op">+</span> <span class="dv">1</span>  <span class="co"># 1 for majority, 2 for minority</span></span>
<span id="cb33-492"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-492" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb33-493"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-493" tabindex="-1"></a>                    grid[x, y] <span class="op">=</span> <span class="dv">0</span>  <span class="co"># 0 for empty</span></span>
<span id="cb33-494"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-494" tabindex="-1"></a>        <span class="cf">return</span> grid</span>
<span id="cb33-495"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-495" tabindex="-1"></a></span>
<span id="cb33-496"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-496" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb33-497"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-497" tabindex="-1"></a>    <span class="kw">def</span> extract_economic_grid(model: EconomicSchellingModel) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb33-498"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-498" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Extract economic grid state (rent prices).&quot;&quot;&quot;</span></span>
<span id="cb33-499"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-499" tabindex="-1"></a>        <span class="cf">return</span> model.rent_grid.copy()</span>
<span id="cb33-500"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-500" tabindex="-1"></a></span>
<span id="cb33-501"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-501" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb33-502"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-502" tabindex="-1"></a>    <span class="kw">def</span> extract_wealth_grid(model: EconomicSchellingModel) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb33-503"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-503" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Extract wealth grid state.&quot;&quot;&quot;</span></span>
<span id="cb33-504"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-504" tabindex="-1"></a>        grid <span class="op">=</span> np.full((model.width, model.height), np.nan)</span>
<span id="cb33-505"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-505" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(model.width):</span>
<span id="cb33-506"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-506" tabindex="-1"></a>            <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(model.height):</span>
<span id="cb33-507"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-507" tabindex="-1"></a>                agents <span class="op">=</span> model.grid.get_cell_list_contents([(x, y)])</span>
<span id="cb33-508"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-508" tabindex="-1"></a>                <span class="cf">if</span> agents:</span>
<span id="cb33-509"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-509" tabindex="-1"></a>                    grid[x, y] <span class="op">=</span> agents[<span class="dv">0</span>].accumulated_wealth</span>
<span id="cb33-510"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-510" tabindex="-1"></a>        <span class="cf">return</span> grid</span>
<span id="cb33-511"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-511" tabindex="-1"></a></span>
<span id="cb33-512"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-512" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb33-513"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-513" tabindex="-1"></a>    <span class="kw">def</span> extract_income_grid(model: EconomicSchellingModel) <span class="op">-&gt;</span> np.ndarray:</span>
<span id="cb33-514"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-514" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Extract income grid state.&quot;&quot;&quot;</span></span>
<span id="cb33-515"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-515" tabindex="-1"></a>        grid <span class="op">=</span> np.full((model.width, model.height), np.nan)</span>
<span id="cb33-516"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-516" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(model.width):</span>
<span id="cb33-517"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-517" tabindex="-1"></a>            <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(model.height):</span>
<span id="cb33-518"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-518" tabindex="-1"></a>                agents <span class="op">=</span> model.grid.get_cell_list_contents([(x, y)])</span>
<span id="cb33-519"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-519" tabindex="-1"></a>                <span class="cf">if</span> agents:</span>
<span id="cb33-520"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-520" tabindex="-1"></a>                    grid[x, y] <span class="op">=</span> agents[<span class="dv">0</span>].income</span>
<span id="cb33-521"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-521" tabindex="-1"></a>        <span class="cf">return</span> grid</span>
<span id="cb33-522"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-522" tabindex="-1"></a></span>
<span id="cb33-523"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-523" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb33-524"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-524" tabindex="-1"></a>    <span class="kw">def</span> create_custom_social_cmap(cls):</span>
<span id="cb33-525"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-525" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Create a custom colormap for social visualization.&quot;&quot;&quot;</span></span>
<span id="cb33-526"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-526" tabindex="-1"></a>        <span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb33-527"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-527" tabindex="-1"></a>        colors <span class="op">=</span> [cls.SOCIAL_COLORS[<span class="st">&#39;Empty&#39;</span>],</span>
<span id="cb33-528"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-528" tabindex="-1"></a>                 cls.SOCIAL_COLORS[<span class="st">&#39;Majority&#39;</span>],</span>
<span id="cb33-529"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-529" tabindex="-1"></a>                 cls.SOCIAL_COLORS[<span class="st">&#39;Minority&#39;</span>]]</span>
<span id="cb33-530"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-530" tabindex="-1"></a>        <span class="cf">return</span> ListedColormap(colors)</span>
<span id="cb33-531"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-531" tabindex="-1"></a></span>
<span id="cb33-532"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-532" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb33-533"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-533" tabindex="-1"></a>    <span class="kw">def</span> plot_static_comparison(cls, model: EconomicSchellingModel,</span>
<span id="cb33-534"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-534" tabindex="-1"></a>                             initial_grid: np.ndarray,</span>
<span id="cb33-535"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-535" tabindex="-1"></a>                             middle_grid: np.ndarray,</span>
<span id="cb33-536"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-536" tabindex="-1"></a>                             steps: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-537"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-537" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Plot initial, middle, final social segregation and rent distribution.&quot;&quot;&quot;</span></span>
<span id="cb33-538"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-538" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb33-539"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-539" tabindex="-1"></a></span>
<span id="cb33-540"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-540" tabindex="-1"></a>        custom_cmap <span class="op">=</span> cls.create_custom_social_cmap()</span>
<span id="cb33-541"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-541" tabindex="-1"></a></span>
<span id="cb33-542"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-542" tabindex="-1"></a>        <span class="co"># Initial Social Segregation</span></span>
<span id="cb33-543"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-543" tabindex="-1"></a>        im1 <span class="op">=</span> axes[<span class="dv">0</span>].imshow(initial_grid, cmap<span class="op">=</span>custom_cmap, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-544"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-544" tabindex="-1"></a>        axes[<span class="dv">0</span>].set_title(<span class="st">&quot;Initial Social Segregation&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-545"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-545" tabindex="-1"></a>        axes[<span class="dv">0</span>].set_xticks([])</span>
<span id="cb33-546"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-546" tabindex="-1"></a>        axes[<span class="dv">0</span>].set_yticks([])</span>
<span id="cb33-547"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-547" tabindex="-1"></a></span>
<span id="cb33-548"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-548" tabindex="-1"></a>        <span class="co"># Middle Social Segregation</span></span>
<span id="cb33-549"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-549" tabindex="-1"></a>        im2 <span class="op">=</span> axes[<span class="dv">1</span>].imshow(middle_grid, cmap<span class="op">=</span>custom_cmap, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-550"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-550" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_title(<span class="ss">f&quot;Step </span><span class="sc">{</span>steps <span class="op">//</span> <span class="dv">2</span><span class="sc">}</span><span class="ss"> Social Segregation&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-551"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-551" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_xticks([])</span>
<span id="cb33-552"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-552" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_yticks([])</span>
<span id="cb33-553"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-553" tabindex="-1"></a></span>
<span id="cb33-554"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-554" tabindex="-1"></a>        <span class="co"># Final Social Segregation</span></span>
<span id="cb33-555"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-555" tabindex="-1"></a>        final_grid <span class="op">=</span> cls.extract_social_grid(model)</span>
<span id="cb33-556"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-556" tabindex="-1"></a>        im3 <span class="op">=</span> axes[<span class="dv">2</span>].imshow(final_grid, cmap<span class="op">=</span>custom_cmap, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb33-557"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-557" tabindex="-1"></a>        axes[<span class="dv">2</span>].set_title(<span class="st">&quot;Final Social Segregation&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-558"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-558" tabindex="-1"></a>        axes[<span class="dv">2</span>].set_xticks([])</span>
<span id="cb33-559"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-559" tabindex="-1"></a>        axes[<span class="dv">2</span>].set_yticks([])</span>
<span id="cb33-560"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-560" tabindex="-1"></a></span>
<span id="cb33-561"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-561" tabindex="-1"></a>        <span class="co"># Rent Distribution</span></span>
<span id="cb33-562"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-562" tabindex="-1"></a>        rent_grid <span class="op">=</span> cls.extract_economic_grid(model)</span>
<span id="cb33-563"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-563" tabindex="-1"></a>        im4 <span class="op">=</span> axes[<span class="dv">3</span>].imshow(rent_grid, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>)</span>
<span id="cb33-564"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-564" tabindex="-1"></a>        axes[<span class="dv">3</span>].set_title(<span class="st">&quot;Rent Distribution&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-565"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-565" tabindex="-1"></a>        axes[<span class="dv">3</span>].set_xticks([])</span>
<span id="cb33-566"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-566" tabindex="-1"></a>        axes[<span class="dv">3</span>].set_yticks([])</span>
<span id="cb33-567"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-567" tabindex="-1"></a>        cbar <span class="op">=</span> plt.colorbar(im4, ax<span class="op">=</span>axes[<span class="dv">3</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-568"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-568" tabindex="-1"></a>        cbar.set_label(<span class="st">&#39;Rent Level&#39;</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb33-569"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-569" tabindex="-1"></a></span>
<span id="cb33-570"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-570" tabindex="-1"></a>        <span class="co"># Add legend for social plots</span></span>
<span id="cb33-571"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-571" tabindex="-1"></a>        <span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb33-572"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-572" tabindex="-1"></a>        empty_patch <span class="op">=</span> mpatches.Patch(color<span class="op">=</span>cls.SOCIAL_COLORS[<span class="st">&#39;Empty&#39;</span>], label<span class="op">=</span><span class="st">&#39;Empty&#39;</span>)</span>
<span id="cb33-573"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-573" tabindex="-1"></a>        majority_patch <span class="op">=</span> mpatches.Patch(color<span class="op">=</span>cls.SOCIAL_COLORS[<span class="st">&#39;Majority&#39;</span>], label<span class="op">=</span><span class="st">&#39;Majority&#39;</span>)</span>
<span id="cb33-574"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-574" tabindex="-1"></a>        minority_patch <span class="op">=</span> mpatches.Patch(color<span class="op">=</span>cls.SOCIAL_COLORS[<span class="st">&#39;Minority&#39;</span>], label<span class="op">=</span><span class="st">&#39;Minority&#39;</span>)</span>
<span id="cb33-575"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-575" tabindex="-1"></a>        fig.legend(handles<span class="op">=</span>[empty_patch, majority_patch, minority_patch],</span>
<span id="cb33-576"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-576" tabindex="-1"></a>                  loc<span class="op">=</span><span class="st">&#39;upper center&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="fl">0.02</span>), ncol<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb33-577"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-577" tabindex="-1"></a></span>
<span id="cb33-578"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-578" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb33-579"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-579" tabindex="-1"></a>        plt.show()</span>
<span id="cb33-580"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-580" tabindex="-1"></a></span>
<span id="cb33-581"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-581" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb33-582"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-582" tabindex="-1"></a>    <span class="kw">def</span> plot_enhanced_metrics(data_frame) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-583"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-583" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Plot comprehensive metrics over time.&quot;&quot;&quot;</span></span>
<span id="cb33-584"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-584" tabindex="-1"></a>        fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">10</span>))</span>
<span id="cb33-585"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-585" tabindex="-1"></a></span>
<span id="cb33-586"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-586" tabindex="-1"></a>        <span class="co"># Social segregation</span></span>
<span id="cb33-587"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-587" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">0</span>].plot(data_frame[<span class="st">&quot;Segregation&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">&#39;blue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-588"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-588" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Social Segregation Over Time&quot;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-589"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-589" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">&quot;Step&quot;</span>)</span>
<span id="cb33-590"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-590" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">&quot;Proportion of Similar Neighbors&quot;</span>)</span>
<span id="cb33-591"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-591" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-592"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-592" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb33-593"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-593" tabindex="-1"></a></span>
<span id="cb33-594"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-594" tabindex="-1"></a>        <span class="co"># Economic segregation</span></span>
<span id="cb33-595"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-595" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">1</span>].plot(data_frame[<span class="st">&quot;Economic_Segregation&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">&#39;green&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-596"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-596" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Economic Segregation Over Time&quot;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-597"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-597" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">&quot;Step&quot;</span>)</span>
<span id="cb33-598"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-598" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">&quot;Income Similarity&quot;</span>)</span>
<span id="cb33-599"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-599" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-600"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-600" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb33-601"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-601" tabindex="-1"></a></span>
<span id="cb33-602"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-602" tabindex="-1"></a>        <span class="co"># Average incomes by group</span></span>
<span id="cb33-603"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-603" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">2</span>].plot(data_frame[<span class="st">&quot;Avg_Income_Majority&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb33-604"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-604" tabindex="-1"></a>                       label<span class="op">=</span><span class="st">&#39;Majority&#39;</span>, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-605"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-605" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">2</span>].plot(data_frame[<span class="st">&quot;Avg_Income_Minority&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb33-606"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-606" tabindex="-1"></a>                       label<span class="op">=</span><span class="st">&#39;Minority&#39;</span>, color<span class="op">=</span><span class="st">&#39;orange&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-607"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-607" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">2</span>].set_title(<span class="st">&quot;Average Income by Group&quot;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-608"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-608" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">2</span>].set_xlabel(<span class="st">&quot;Step&quot;</span>)</span>
<span id="cb33-609"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-609" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">2</span>].set_ylabel(<span class="st">&quot;Average Income&quot;</span>)</span>
<span id="cb33-610"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-610" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">2</span>].legend()</span>
<span id="cb33-611"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-611" tabindex="-1"></a>        axes[<span class="dv">0</span>, <span class="dv">2</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-612"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-612" tabindex="-1"></a></span>
<span id="cb33-613"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-613" tabindex="-1"></a>        <span class="co"># Average wealth by group</span></span>
<span id="cb33-614"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-614" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">0</span>].plot(data_frame[<span class="st">&quot;Avg_Wealth_Majority&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb33-615"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-615" tabindex="-1"></a>                       label<span class="op">=</span><span class="st">&#39;Majority&#39;</span>, color<span class="op">=</span><span class="st">&#39;darkred&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-616"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-616" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">0</span>].plot(data_frame[<span class="st">&quot;Avg_Wealth_Minority&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb33-617"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-617" tabindex="-1"></a>                       label<span class="op">=</span><span class="st">&#39;Minority&#39;</span>, color<span class="op">=</span><span class="st">&#39;darkorange&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-618"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-618" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Average Wealth by Group&quot;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-619"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-619" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">&quot;Step&quot;</span>)</span>
<span id="cb33-620"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-620" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">&quot;Average Wealth&quot;</span>)</span>
<span id="cb33-621"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-621" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">0</span>].legend()</span>
<span id="cb33-622"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-622" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">0</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-623"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-623" tabindex="-1"></a></span>
<span id="cb33-624"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-624" tabindex="-1"></a>        <span class="co"># Income inequality ratio</span></span>
<span id="cb33-625"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-625" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].plot(data_frame[<span class="st">&quot;Income_Inequality_Ratio&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">&#39;purple&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-626"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-626" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Income Inequality Ratio&quot;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-627"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-627" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">&quot;Step&quot;</span>)</span>
<span id="cb33-628"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-628" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">&quot;Ratio (Majority/Minority)&quot;</span>)</span>
<span id="cb33-629"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-629" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-630"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-630" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].axhline(y<span class="op">=</span><span class="fl">1.0</span>, color<span class="op">=</span><span class="st">&#39;r&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">&#39;Equality Line&#39;</span>)</span>
<span id="cb33-631"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-631" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">1</span>].legend()</span>
<span id="cb33-632"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-632" tabindex="-1"></a></span>
<span id="cb33-633"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-633" tabindex="-1"></a>        <span class="co"># Unhappy agents over time</span></span>
<span id="cb33-634"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-634" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">2</span>].plot(data_frame[<span class="st">&quot;Unhappy_Agents&quot;</span>], linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb33-635"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-635" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">2</span>].set_title(<span class="st">&quot;Unhappy Agents Over Time&quot;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-636"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-636" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">2</span>].set_xlabel(<span class="st">&quot;Step&quot;</span>)</span>
<span id="cb33-637"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-637" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">2</span>].set_ylabel(<span class="st">&quot;Number of Unhappy Agents&quot;</span>)</span>
<span id="cb33-638"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-638" tabindex="-1"></a>        axes[<span class="dv">1</span>, <span class="dv">2</span>].grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-639"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-639" tabindex="-1"></a></span>
<span id="cb33-640"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-640" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb33-641"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-641" tabindex="-1"></a>        plt.show()</span>
<span id="cb33-642"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-642" tabindex="-1"></a></span>
<span id="cb33-643"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-643" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb33-644"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-644" tabindex="-1"></a>    <span class="kw">def</span> plot_income_distribution(model: EconomicSchellingModel) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-645"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-645" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Plot enhanced income distribution comparison.&quot;&quot;&quot;</span></span>
<span id="cb33-646"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-646" tabindex="-1"></a>        majority_incomes <span class="op">=</span> [agent.income <span class="cf">for</span> agent <span class="kw">in</span> model.schedule.agents</span>
<span id="cb33-647"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-647" tabindex="-1"></a>                           <span class="cf">if</span> agent.<span class="bu">type</span> <span class="op">==</span> AgentType.MAJORITY]</span>
<span id="cb33-648"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-648" tabindex="-1"></a>        minority_incomes <span class="op">=</span> [agent.income <span class="cf">for</span> agent <span class="kw">in</span> model.schedule.agents</span>
<span id="cb33-649"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-649" tabindex="-1"></a>                           <span class="cf">if</span> agent.<span class="bu">type</span> <span class="op">==</span> AgentType.MINORITY]</span>
<span id="cb33-650"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-650" tabindex="-1"></a></span>
<span id="cb33-651"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-651" tabindex="-1"></a>        fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb33-652"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-652" tabindex="-1"></a></span>
<span id="cb33-653"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-653" tabindex="-1"></a>        <span class="co"># Income distributions</span></span>
<span id="cb33-654"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-654" tabindex="-1"></a>        ax1.hist(majority_incomes, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">&#39;Majority&#39;</span>,</span>
<span id="cb33-655"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-655" tabindex="-1"></a>                color<span class="op">=</span><span class="st">&#39;red&#39;</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-656"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-656" tabindex="-1"></a>        ax1.hist(minority_incomes, bins<span class="op">=</span><span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">&#39;Minority&#39;</span>,</span>
<span id="cb33-657"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-657" tabindex="-1"></a>                color<span class="op">=</span><span class="st">&#39;orange&#39;</span>, density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-658"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-658" tabindex="-1"></a>        ax1.set_xlabel(<span class="st">&#39;Income&#39;</span>)</span>
<span id="cb33-659"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-659" tabindex="-1"></a>        ax1.set_ylabel(<span class="st">&#39;Density&#39;</span>)</span>
<span id="cb33-660"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-660" tabindex="-1"></a>        ax1.set_title(<span class="st">&#39;Income Distribution by Group&#39;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-661"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-661" tabindex="-1"></a>        ax1.legend()</span>
<span id="cb33-662"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-662" tabindex="-1"></a>        ax1.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-663"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-663" tabindex="-1"></a></span>
<span id="cb33-664"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-664" tabindex="-1"></a>        <span class="co"># Box plot comparison</span></span>
<span id="cb33-665"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-665" tabindex="-1"></a>        ax2.boxplot([majority_incomes, minority_incomes],</span>
<span id="cb33-666"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-666" tabindex="-1"></a>                   labels<span class="op">=</span>[<span class="st">&#39;Majority&#39;</span>, <span class="st">&#39;Minority&#39;</span>],</span>
<span id="cb33-667"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-667" tabindex="-1"></a>                   patch_artist<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb33-668"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-668" tabindex="-1"></a>                   boxprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">&#39;lightblue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>))</span>
<span id="cb33-669"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-669" tabindex="-1"></a>        ax2.set_ylabel(<span class="st">&#39;Income&#39;</span>)</span>
<span id="cb33-670"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-670" tabindex="-1"></a>        ax2.set_title(<span class="st">&#39;Income Distribution Comparison&#39;</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-671"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-671" tabindex="-1"></a>        ax2.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb33-672"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-672" tabindex="-1"></a></span>
<span id="cb33-673"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-673" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb33-674"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-674" tabindex="-1"></a>        plt.show()</span>
<span id="cb33-675"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-675" tabindex="-1"></a></span>
<span id="cb33-676"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-676" tabindex="-1"></a></span>
<span id="cb33-677"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-677" tabindex="-1"></a><span class="kw">def</span> run_economic_schelling_model(<span class="op">**</span>config) <span class="op">-&gt;</span> EconomicSchellingModel:</span>
<span id="cb33-678"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-678" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-679"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-679" tabindex="-1"></a><span class="co">    Run the Enhanced Economic Schelling segregation model.</span></span>
<span id="cb33-680"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-680" tabindex="-1"></a></span>
<span id="cb33-681"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-681" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb33-682"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-682" tabindex="-1"></a><span class="co">        **config: Model configuration parameters</span></span>
<span id="cb33-683"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-683" tabindex="-1"></a></span>
<span id="cb33-684"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-684" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb33-685"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-685" tabindex="-1"></a><span class="co">        Completed EconomicSchellingModel instance</span></span>
<span id="cb33-686"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-686" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb33-687"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-687" tabindex="-1"></a>    <span class="co"># Enhanced default configuration</span></span>
<span id="cb33-688"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-688" tabindex="-1"></a>    default_config <span class="op">=</span> {</span>
<span id="cb33-689"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-689" tabindex="-1"></a>        <span class="st">&#39;width&#39;</span>: <span class="dv">20</span>,</span>
<span id="cb33-690"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-690" tabindex="-1"></a>        <span class="st">&#39;height&#39;</span>: <span class="dv">20</span>,</span>
<span id="cb33-691"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-691" tabindex="-1"></a>        <span class="st">&#39;density&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb33-692"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-692" tabindex="-1"></a>        <span class="st">&#39;minority_pc&#39;</span>: <span class="fl">0.3</span>,</span>
<span id="cb33-693"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-693" tabindex="-1"></a>        <span class="st">&#39;similarity_threshold&#39;</span>: <span class="fl">0.6</span>,</span>
<span id="cb33-694"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-694" tabindex="-1"></a>        <span class="st">&#39;majority_base_income&#39;</span>: <span class="fl">15.0</span>,</span>
<span id="cb33-695"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-695" tabindex="-1"></a>        <span class="st">&#39;minority_base_income&#39;</span>: <span class="fl">8.0</span>,</span>
<span id="cb33-696"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-696" tabindex="-1"></a>        <span class="st">&#39;income_variance&#39;</span>: <span class="fl">3.0</span>,</span>
<span id="cb33-697"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-697" tabindex="-1"></a>        <span class="st">&#39;rent_distribution&#39;</span>: <span class="st">&#39;uniform&#39;</span>,</span>
<span id="cb33-698"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-698" tabindex="-1"></a>        <span class="st">&#39;base_rent&#39;</span>: <span class="fl">2.0</span>,</span>
<span id="cb33-699"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-699" tabindex="-1"></a>        <span class="st">&#39;rent_variance&#39;</span>: <span class="fl">1.0</span>,</span>
<span id="cb33-700"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-700" tabindex="-1"></a>        <span class="st">&#39;moving_cost&#39;</span>: <span class="fl">1.0</span>,</span>
<span id="cb33-701"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-701" tabindex="-1"></a>        <span class="st">&#39;income_distribution&#39;</span>: <span class="st">&#39;normal&#39;</span>,</span>
<span id="cb33-702"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-702" tabindex="-1"></a>        <span class="st">&#39;steps&#39;</span>: <span class="dv">50</span></span>
<span id="cb33-703"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-703" tabindex="-1"></a>    }</span>
<span id="cb33-704"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-704" tabindex="-1"></a></span>
<span id="cb33-705"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-705" tabindex="-1"></a>    <span class="co"># Update with provided config</span></span>
<span id="cb33-706"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-706" tabindex="-1"></a>    default_config.update(config)</span>
<span id="cb33-707"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-707" tabindex="-1"></a>    config <span class="op">=</span> default_config</span>
<span id="cb33-708"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-708" tabindex="-1"></a></span>
<span id="cb33-709"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-709" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb33-710"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-710" tabindex="-1"></a>        <span class="co"># Initialize model</span></span>
<span id="cb33-711"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-711" tabindex="-1"></a>        model <span class="op">=</span> EconomicSchellingModel(</span>
<span id="cb33-712"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-712" tabindex="-1"></a>            width<span class="op">=</span>config[<span class="st">&#39;width&#39;</span>],</span>
<span id="cb33-713"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-713" tabindex="-1"></a>            height<span class="op">=</span>config[<span class="st">&#39;height&#39;</span>],</span>
<span id="cb33-714"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-714" tabindex="-1"></a>            density<span class="op">=</span>config[<span class="st">&#39;density&#39;</span>],</span>
<span id="cb33-715"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-715" tabindex="-1"></a>            minority_pc<span class="op">=</span>config[<span class="st">&#39;minority_pc&#39;</span>],</span>
<span id="cb33-716"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-716" tabindex="-1"></a>            similarity_threshold<span class="op">=</span>config[<span class="st">&#39;similarity_threshold&#39;</span>],</span>
<span id="cb33-717"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-717" tabindex="-1"></a>            majority_base_income<span class="op">=</span>config[<span class="st">&#39;majority_base_income&#39;</span>],</span>
<span id="cb33-718"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-718" tabindex="-1"></a>            minority_base_income<span class="op">=</span>config[<span class="st">&#39;minority_base_income&#39;</span>],</span>
<span id="cb33-719"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-719" tabindex="-1"></a>            income_variance<span class="op">=</span>config[<span class="st">&#39;income_variance&#39;</span>],</span>
<span id="cb33-720"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-720" tabindex="-1"></a>            rent_distribution<span class="op">=</span>config[<span class="st">&#39;rent_distribution&#39;</span>],</span>
<span id="cb33-721"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-721" tabindex="-1"></a>            base_rent<span class="op">=</span>config[<span class="st">&#39;base_rent&#39;</span>],</span>
<span id="cb33-722"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-722" tabindex="-1"></a>            rent_variance<span class="op">=</span>config[<span class="st">&#39;rent_variance&#39;</span>],</span>
<span id="cb33-723"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-723" tabindex="-1"></a>            moving_cost<span class="op">=</span>config[<span class="st">&#39;moving_cost&#39;</span>],</span>
<span id="cb33-724"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-724" tabindex="-1"></a>            income_distribution<span class="op">=</span>config[<span class="st">&#39;income_distribution&#39;</span>]</span>
<span id="cb33-725"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-725" tabindex="-1"></a>        )</span>
<span id="cb33-726"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-726" tabindex="-1"></a></span>
<span id="cb33-727"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-727" tabindex="-1"></a>        <span class="co"># Store initial state for comparison</span></span>
<span id="cb33-728"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-728" tabindex="-1"></a>        initial_grid <span class="op">=</span> EconomicSchellingVisualizer.extract_social_grid(model)</span>
<span id="cb33-729"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-729" tabindex="-1"></a>        middle_grid <span class="op">=</span> <span class="va">None</span></span>
<span id="cb33-730"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-730" tabindex="-1"></a></span>
<span id="cb33-731"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-731" tabindex="-1"></a>        logger.info(<span class="ss">f&quot;Starting simulation with </span><span class="sc">{</span><span class="bu">len</span>(model.schedule.agents)<span class="sc">}</span><span class="ss"> agents for </span><span class="sc">{</span>config[<span class="st">&#39;steps&#39;</span>]<span class="sc">}</span><span class="ss"> steps...&quot;</span>)</span>
<span id="cb33-732"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-732" tabindex="-1"></a></span>
<span id="cb33-733"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-733" tabindex="-1"></a>        <span class="co"># Run simulation</span></span>
<span id="cb33-734"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-734" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(config[<span class="st">&#39;steps&#39;</span>]):</span>
<span id="cb33-735"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-735" tabindex="-1"></a>            model.step()</span>
<span id="cb33-736"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-736" tabindex="-1"></a></span>
<span id="cb33-737"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-737" tabindex="-1"></a>            <span class="co"># Capture middle state</span></span>
<span id="cb33-738"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-738" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">+</span> <span class="dv">1</span> <span class="op">==</span> config[<span class="st">&#39;steps&#39;</span>] <span class="op">//</span> <span class="dv">2</span>:</span>
<span id="cb33-739"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-739" tabindex="-1"></a>                middle_grid <span class="op">=</span> EconomicSchellingVisualizer.extract_social_grid(model)</span>
<span id="cb33-740"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-740" tabindex="-1"></a></span>
<span id="cb33-741"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-741" tabindex="-1"></a>            <span class="co"># Progress logging</span></span>
<span id="cb33-742"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-742" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span> <span class="kw">or</span> i <span class="op">==</span> config[<span class="st">&#39;steps&#39;</span>] <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb33-743"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-743" tabindex="-1"></a>                segregation <span class="op">=</span> model.calculate_segregation()</span>
<span id="cb33-744"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-744" tabindex="-1"></a>                inequality_ratio <span class="op">=</span> model.calculate_income_inequality_ratio()</span>
<span id="cb33-745"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-745" tabindex="-1"></a>                unhappy <span class="op">=</span> model.count_unhappy_agents()</span>
<span id="cb33-746"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-746" tabindex="-1"></a>                logger.info(<span class="ss">f&quot;Step </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>config[<span class="st">&#39;steps&#39;</span>]<span class="sc">}</span><span class="ss">: Segregation=</span><span class="sc">{</span>segregation<span class="sc">:.3f}</span><span class="ss">, &quot;</span></span>
<span id="cb33-747"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-747" tabindex="-1"></a>                          <span class="ss">f&quot;Inequality=</span><span class="sc">{</span>inequality_ratio<span class="sc">:.2f}</span><span class="ss">x, Unhappy=</span><span class="sc">{</span>unhappy<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-748"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-748" tabindex="-1"></a></span>
<span id="cb33-749"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-749" tabindex="-1"></a>        <span class="co"># Create visualizations</span></span>
<span id="cb33-750"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-750" tabindex="-1"></a>        logger.info(<span class="st">&quot;Generating visualizations...&quot;</span>)</span>
<span id="cb33-751"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-751" tabindex="-1"></a></span>
<span id="cb33-752"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-752" tabindex="-1"></a>        <span class="co"># Static comparison plot</span></span>
<span id="cb33-753"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-753" tabindex="-1"></a>        EconomicSchellingVisualizer.plot_static_comparison(</span>
<span id="cb33-754"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-754" tabindex="-1"></a>            model, initial_grid, middle_grid, config[<span class="st">&#39;steps&#39;</span>]</span>
<span id="cb33-755"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-755" tabindex="-1"></a>        )</span>
<span id="cb33-756"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-756" tabindex="-1"></a></span>
<span id="cb33-757"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-757" tabindex="-1"></a>        <span class="co"># Enhanced metrics plot</span></span>
<span id="cb33-758"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-758" tabindex="-1"></a>        metrics_data <span class="op">=</span> model.datacollector.get_model_vars_dataframe()</span>
<span id="cb33-759"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-759" tabindex="-1"></a>        EconomicSchellingVisualizer.plot_enhanced_metrics(metrics_data)</span>
<span id="cb33-760"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-760" tabindex="-1"></a></span>
<span id="cb33-761"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-761" tabindex="-1"></a>        <span class="co"># Income distribution plot</span></span>
<span id="cb33-762"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-762" tabindex="-1"></a>        EconomicSchellingVisualizer.plot_income_distribution(model)</span>
<span id="cb33-763"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-763" tabindex="-1"></a></span>
<span id="cb33-764"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-764" tabindex="-1"></a>        logger.info(<span class="st">&quot;Model execution completed successfully.&quot;</span>)</span>
<span id="cb33-765"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-765" tabindex="-1"></a>        <span class="cf">return</span> model</span>
<span id="cb33-766"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-766" tabindex="-1"></a></span>
<span id="cb33-767"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-767" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb33-768"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-768" tabindex="-1"></a>        logger.error(<span class="ss">f&quot;Error during model execution: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-769"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-769" tabindex="-1"></a>        <span class="cf">raise</span></span>
<span id="cb33-770"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-770" tabindex="-1"></a></span>
<span id="cb33-771"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-771" tabindex="-1"></a></span>
<span id="cb33-772"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-772" tabindex="-1"></a><span class="kw">def</span> analyze_model_results(model: EconomicSchellingModel) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb33-773"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-773" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-774"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-774" tabindex="-1"></a><span class="co">    Analyze and return comprehensive model results.</span></span>
<span id="cb33-775"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-775" tabindex="-1"></a></span>
<span id="cb33-776"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-776" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb33-777"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-777" tabindex="-1"></a><span class="co">        model: Completed EconomicSchellingModel instance</span></span>
<span id="cb33-778"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-778" tabindex="-1"></a></span>
<span id="cb33-779"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-779" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb33-780"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-780" tabindex="-1"></a><span class="co">        Dictionary containing analysis results</span></span>
<span id="cb33-781"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-781" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb33-782"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-782" tabindex="-1"></a>    <span class="co"># Calculate final metrics</span></span>
<span id="cb33-783"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-783" tabindex="-1"></a>    final_segregation <span class="op">=</span> model.calculate_segregation()</span>
<span id="cb33-784"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-784" tabindex="-1"></a>    final_economic_segregation <span class="op">=</span> model.calculate_economic_segregation()</span>
<span id="cb33-785"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-785" tabindex="-1"></a>    inequality_ratio <span class="op">=</span> model.calculate_income_inequality_ratio()</span>
<span id="cb33-786"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-786" tabindex="-1"></a>    total_moves <span class="op">=</span> model.total_moves</span>
<span id="cb33-787"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-787" tabindex="-1"></a>    unhappy_agents <span class="op">=</span> model.count_unhappy_agents()</span>
<span id="cb33-788"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-788" tabindex="-1"></a></span>
<span id="cb33-789"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-789" tabindex="-1"></a>    <span class="co"># Income statistics</span></span>
<span id="cb33-790"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-790" tabindex="-1"></a>    avg_majority_income <span class="op">=</span> model._calculate_avg_income(AgentType.MAJORITY)</span>
<span id="cb33-791"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-791" tabindex="-1"></a>    avg_minority_income <span class="op">=</span> model._calculate_avg_income(AgentType.MINORITY)</span>
<span id="cb33-792"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-792" tabindex="-1"></a>    avg_majority_wealth <span class="op">=</span> model._calculate_avg_wealth(AgentType.MAJORITY)</span>
<span id="cb33-793"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-793" tabindex="-1"></a>    avg_minority_wealth <span class="op">=</span> model._calculate_avg_wealth(AgentType.MINORITY)</span>
<span id="cb33-794"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-794" tabindex="-1"></a></span>
<span id="cb33-795"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-795" tabindex="-1"></a>    <span class="co"># Agent counts</span></span>
<span id="cb33-796"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-796" tabindex="-1"></a>    majority_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> agent <span class="kw">in</span> model.schedule.agents</span>
<span id="cb33-797"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-797" tabindex="-1"></a>                        <span class="cf">if</span> agent.<span class="bu">type</span> <span class="op">==</span> AgentType.MAJORITY)</span>
<span id="cb33-798"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-798" tabindex="-1"></a>    minority_count <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> agent <span class="kw">in</span> model.schedule.agents</span>
<span id="cb33-799"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-799" tabindex="-1"></a>                        <span class="cf">if</span> agent.<span class="bu">type</span> <span class="op">==</span> AgentType.MINORITY)</span>
<span id="cb33-800"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-800" tabindex="-1"></a></span>
<span id="cb33-801"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-801" tabindex="-1"></a>    <span class="co"># Rent statistics</span></span>
<span id="cb33-802"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-802" tabindex="-1"></a>    avg_rent_occupied <span class="op">=</span> model._calculate_avg_rent_occupied()</span>
<span id="cb33-803"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-803" tabindex="-1"></a>    min_rent <span class="op">=</span> np.<span class="bu">min</span>(model.rent_grid)</span>
<span id="cb33-804"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-804" tabindex="-1"></a>    max_rent <span class="op">=</span> np.<span class="bu">max</span>(model.rent_grid)</span>
<span id="cb33-805"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-805" tabindex="-1"></a></span>
<span id="cb33-806"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-806" tabindex="-1"></a>    results <span class="op">=</span> {</span>
<span id="cb33-807"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-807" tabindex="-1"></a>        <span class="st">&#39;final_metrics&#39;</span>: {</span>
<span id="cb33-808"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-808" tabindex="-1"></a>            <span class="st">&#39;social_segregation&#39;</span>: final_segregation,</span>
<span id="cb33-809"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-809" tabindex="-1"></a>            <span class="st">&#39;economic_segregation&#39;</span>: final_economic_segregation,</span>
<span id="cb33-810"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-810" tabindex="-1"></a>            <span class="st">&#39;income_inequality_ratio&#39;</span>: inequality_ratio,</span>
<span id="cb33-811"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-811" tabindex="-1"></a>            <span class="st">&#39;total_moves&#39;</span>: total_moves,</span>
<span id="cb33-812"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-812" tabindex="-1"></a>            <span class="st">&#39;unhappy_agents&#39;</span>: unhappy_agents,</span>
<span id="cb33-813"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-813" tabindex="-1"></a>            <span class="st">&#39;unhappy_percentage&#39;</span>: (unhappy_agents <span class="op">/</span> <span class="bu">len</span>(model.schedule.agents)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb33-814"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-814" tabindex="-1"></a>        },</span>
<span id="cb33-815"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-815" tabindex="-1"></a>        <span class="st">&#39;demographics&#39;</span>: {</span>
<span id="cb33-816"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-816" tabindex="-1"></a>            <span class="st">&#39;total_agents&#39;</span>: <span class="bu">len</span>(model.schedule.agents),</span>
<span id="cb33-817"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-817" tabindex="-1"></a>            <span class="st">&#39;majority_count&#39;</span>: majority_count,</span>
<span id="cb33-818"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-818" tabindex="-1"></a>            <span class="st">&#39;minority_count&#39;</span>: minority_count,</span>
<span id="cb33-819"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-819" tabindex="-1"></a>            <span class="st">&#39;minority_percentage&#39;</span>: (minority_count <span class="op">/</span> <span class="bu">len</span>(model.schedule.agents)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb33-820"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-820" tabindex="-1"></a>        },</span>
<span id="cb33-821"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-821" tabindex="-1"></a>        <span class="st">&#39;economic_stats&#39;</span>: {</span>
<span id="cb33-822"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-822" tabindex="-1"></a>            <span class="st">&#39;avg_majority_income&#39;</span>: avg_majority_income,</span>
<span id="cb33-823"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-823" tabindex="-1"></a>            <span class="st">&#39;avg_minority_income&#39;</span>: avg_minority_income,</span>
<span id="cb33-824"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-824" tabindex="-1"></a>            <span class="st">&#39;avg_majority_wealth&#39;</span>: avg_majority_wealth,</span>
<span id="cb33-825"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-825" tabindex="-1"></a>            <span class="st">&#39;avg_minority_wealth&#39;</span>: avg_minority_wealth,</span>
<span id="cb33-826"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-826" tabindex="-1"></a>            <span class="st">&#39;wealth_inequality_ratio&#39;</span>: (avg_majority_wealth <span class="op">/</span> avg_minority_wealth</span>
<span id="cb33-827"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-827" tabindex="-1"></a>                                      <span class="cf">if</span> avg_minority_wealth <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="bu">float</span>(<span class="st">&#39;inf&#39;</span>))</span>
<span id="cb33-828"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-828" tabindex="-1"></a>        },</span>
<span id="cb33-829"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-829" tabindex="-1"></a>        <span class="st">&#39;housing_stats&#39;</span>: {</span>
<span id="cb33-830"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-830" tabindex="-1"></a>            <span class="st">&#39;avg_rent_occupied&#39;</span>: avg_rent_occupied,</span>
<span id="cb33-831"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-831" tabindex="-1"></a>            <span class="st">&#39;min_rent&#39;</span>: min_rent,</span>
<span id="cb33-832"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-832" tabindex="-1"></a>            <span class="st">&#39;max_rent&#39;</span>: max_rent,</span>
<span id="cb33-833"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-833" tabindex="-1"></a>            <span class="st">&#39;rent_range&#39;</span>: max_rent <span class="op">-</span> min_rent</span>
<span id="cb33-834"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-834" tabindex="-1"></a>        }</span>
<span id="cb33-835"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-835" tabindex="-1"></a>    }</span>
<span id="cb33-836"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-836" tabindex="-1"></a></span>
<span id="cb33-837"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-837" tabindex="-1"></a>    <span class="cf">return</span> results</span>
<span id="cb33-838"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-838" tabindex="-1"></a></span>
<span id="cb33-839"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-839" tabindex="-1"></a></span>
<span id="cb33-840"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-840" tabindex="-1"></a><span class="kw">def</span> print_model_summary(results: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb33-841"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-841" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb33-842"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-842" tabindex="-1"></a><span class="co">    Print a comprehensive summary of model results.</span></span>
<span id="cb33-843"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-843" tabindex="-1"></a></span>
<span id="cb33-844"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-844" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb33-845"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-845" tabindex="-1"></a><span class="co">        results: Results dictionary from analyze_model_results</span></span>
<span id="cb33-846"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-846" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb33-847"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-847" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb33-848"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-848" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;ECONOMIC SCHELLING MODEL - FINAL RESULTS&quot;</span>)</span>
<span id="cb33-849"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-849" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;=&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb33-850"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-850" tabindex="-1"></a></span>
<span id="cb33-851"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-851" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📊 SEGREGATION METRICS:&quot;</span>)</span>
<span id="cb33-852"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-852" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Social Segregation: </span><span class="sc">{</span>results[<span class="st">&#39;final_metrics&#39;</span>][<span class="st">&#39;social_segregation&#39;</span>]<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-853"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-853" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Economic Segregation: </span><span class="sc">{</span>results[<span class="st">&#39;final_metrics&#39;</span>][<span class="st">&#39;economic_segregation&#39;</span>]<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-854"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-854" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Agent Satisfaction: </span><span class="sc">{</span><span class="dv">100</span><span class="op">-</span>results[<span class="st">&#39;final_metrics&#39;</span>][<span class="st">&#39;unhappy_percentage&#39;</span>]<span class="sc">:.1f}</span><span class="ss">% satisfied&quot;</span>)</span>
<span id="cb33-855"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-855" tabindex="-1"></a></span>
<span id="cb33-856"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-856" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">👥 DEMOGRAPHICS:&quot;</span>)</span>
<span id="cb33-857"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-857" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Total Agents: </span><span class="sc">{</span>results[<span class="st">&#39;demographics&#39;</span>][<span class="st">&#39;total_agents&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-858"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-858" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Majority: </span><span class="sc">{</span>results[<span class="st">&#39;demographics&#39;</span>][<span class="st">&#39;majority_count&#39;</span>]<span class="sc">}</span><span class="ss"> &quot;</span></span>
<span id="cb33-859"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-859" tabindex="-1"></a>          <span class="ss">f&quot;(</span><span class="sc">{</span><span class="dv">100</span><span class="op">-</span>results[<span class="st">&#39;demographics&#39;</span>][<span class="st">&#39;minority_percentage&#39;</span>]<span class="sc">:.1f}</span><span class="ss">%)&quot;</span>)</span>
<span id="cb33-860"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-860" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Minority: </span><span class="sc">{</span>results[<span class="st">&#39;demographics&#39;</span>][<span class="st">&#39;minority_count&#39;</span>]<span class="sc">}</span><span class="ss"> &quot;</span></span>
<span id="cb33-861"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-861" tabindex="-1"></a>          <span class="ss">f&quot;(</span><span class="sc">{</span>results[<span class="st">&#39;demographics&#39;</span>][<span class="st">&#39;minority_percentage&#39;</span>]<span class="sc">:.1f}</span><span class="ss">%)&quot;</span>)</span>
<span id="cb33-862"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-862" tabindex="-1"></a></span>
<span id="cb33-863"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-863" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">💰 ECONOMIC INEQUALITY:&quot;</span>)</span>
<span id="cb33-864"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-864" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Income Inequality Ratio: </span><span class="sc">{</span>results[<span class="st">&#39;final_metrics&#39;</span>][<span class="st">&#39;income_inequality_ratio&#39;</span>]<span class="sc">:.2f}</span><span class="ss">x&quot;</span>)</span>
<span id="cb33-865"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-865" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Wealth Inequality Ratio: </span><span class="sc">{</span>results[<span class="st">&#39;economic_stats&#39;</span>][<span class="st">&#39;wealth_inequality_ratio&#39;</span>]<span class="sc">:.2f}</span><span class="ss">x&quot;</span>)</span>
<span id="cb33-866"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-866" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Majority Avg Income: $</span><span class="sc">{</span>results[<span class="st">&#39;economic_stats&#39;</span>][<span class="st">&#39;avg_majority_income&#39;</span>]<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-867"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-867" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Minority Avg Income: $</span><span class="sc">{</span>results[<span class="st">&#39;economic_stats&#39;</span>][<span class="st">&#39;avg_minority_income&#39;</span>]<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-868"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-868" tabindex="-1"></a></span>
<span id="cb33-869"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-869" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🏠 HOUSING MARKET:&quot;</span>)</span>
<span id="cb33-870"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-870" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Average Rent (Occupied): $</span><span class="sc">{</span>results[<span class="st">&#39;housing_stats&#39;</span>][<span class="st">&#39;avg_rent_occupied&#39;</span>]<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-871"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-871" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Rent Range: $</span><span class="sc">{</span>results[<span class="st">&#39;housing_stats&#39;</span>][<span class="st">&#39;min_rent&#39;</span>]<span class="sc">:.2f}</span><span class="ss"> - &quot;</span></span>
<span id="cb33-872"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-872" tabindex="-1"></a>          <span class="ss">f&quot;$</span><span class="sc">{</span>results[<span class="st">&#39;housing_stats&#39;</span>][<span class="st">&#39;max_rent&#39;</span>]<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-873"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-873" tabindex="-1"></a></span>
<span id="cb33-874"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-874" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🚚 MOBILITY:&quot;</span>)</span>
<span id="cb33-875"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-875" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Total Moves: </span><span class="sc">{</span>results[<span class="st">&#39;final_metrics&#39;</span>][<span class="st">&#39;total_moves&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-876"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-876" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;   Unhappy Agents: </span><span class="sc">{</span>results[<span class="st">&#39;final_metrics&#39;</span>][<span class="st">&#39;unhappy_agents&#39;</span>]<span class="sc">}</span><span class="ss"> &quot;</span></span>
<span id="cb33-877"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-877" tabindex="-1"></a>          <span class="ss">f&quot;(</span><span class="sc">{</span>results[<span class="st">&#39;final_metrics&#39;</span>][<span class="st">&#39;unhappy_percentage&#39;</span>]<span class="sc">:.1f}</span><span class="ss">%)&quot;</span>)</span>
<span id="cb33-878"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-878" tabindex="-1"></a></span>
<span id="cb33-879"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-879" tabindex="-1"></a></span>
<span id="cb33-880"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-880" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb33-881"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-881" tabindex="-1"></a>    <span class="co"># Enhanced model configuration</span></span>
<span id="cb33-882"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-882" tabindex="-1"></a>    CONFIG <span class="op">=</span> {</span>
<span id="cb33-883"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-883" tabindex="-1"></a>        <span class="st">&#39;width&#39;</span>: <span class="dv">25</span>,</span>
<span id="cb33-884"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-884" tabindex="-1"></a>        <span class="st">&#39;height&#39;</span>: <span class="dv">25</span>,</span>
<span id="cb33-885"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-885" tabindex="-1"></a>        <span class="st">&#39;density&#39;</span>: <span class="fl">0.8</span>,</span>
<span id="cb33-886"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-886" tabindex="-1"></a>        <span class="st">&#39;minority_pc&#39;</span>: <span class="fl">0.3</span>,</span>
<span id="cb33-887"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-887" tabindex="-1"></a>        <span class="st">&#39;similarity_threshold&#39;</span>: <span class="fl">0.5</span>,</span>
<span id="cb33-888"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-888" tabindex="-1"></a>        <span class="st">&#39;majority_base_income&#39;</span>: <span class="fl">15.0</span>,</span>
<span id="cb33-889"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-889" tabindex="-1"></a>        <span class="st">&#39;minority_base_income&#39;</span>: <span class="fl">8.0</span>,    <span class="co"># ~53% of majority income</span></span>
<span id="cb33-890"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-890" tabindex="-1"></a>        <span class="st">&#39;income_variance&#39;</span>: <span class="fl">4.0</span>,</span>
<span id="cb33-891"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-891" tabindex="-1"></a>        <span class="st">&#39;rent_distribution&#39;</span>: <span class="st">&#39;gradient&#39;</span>,</span>
<span id="cb33-892"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-892" tabindex="-1"></a>        <span class="st">&#39;base_rent&#39;</span>: <span class="fl">3.0</span>,</span>
<span id="cb33-893"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-893" tabindex="-1"></a>        <span class="st">&#39;rent_variance&#39;</span>: <span class="fl">5.0</span>,</span>
<span id="cb33-894"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-894" tabindex="-1"></a>        <span class="st">&#39;moving_cost&#39;</span>: <span class="fl">2.0</span>,</span>
<span id="cb33-895"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-895" tabindex="-1"></a>        <span class="st">&#39;income_distribution&#39;</span>: <span class="st">&#39;normal&#39;</span>,</span>
<span id="cb33-896"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-896" tabindex="-1"></a>        <span class="st">&#39;steps&#39;</span>: <span class="dv">100</span></span>
<span id="cb33-897"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-897" tabindex="-1"></a>    }</span>
<span id="cb33-898"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-898" tabindex="-1"></a></span>
<span id="cb33-899"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-899" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb33-900"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-900" tabindex="-1"></a>        <span class="co"># Run model</span></span>
<span id="cb33-901"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-901" tabindex="-1"></a>        logger.info(<span class="st">&quot;Starting Enhanced Economic Schelling model...&quot;</span>)</span>
<span id="cb33-902"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-902" tabindex="-1"></a>        model <span class="op">=</span> run_economic_schelling_model(<span class="op">**</span>CONFIG)</span>
<span id="cb33-903"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-903" tabindex="-1"></a></span>
<span id="cb33-904"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-904" tabindex="-1"></a>        <span class="co"># Analyze results</span></span>
<span id="cb33-905"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-905" tabindex="-1"></a>        results <span class="op">=</span> analyze_model_results(model)</span>
<span id="cb33-906"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-906" tabindex="-1"></a></span>
<span id="cb33-907"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-907" tabindex="-1"></a>        <span class="co"># Print summary</span></span>
<span id="cb33-908"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-908" tabindex="-1"></a>        print_model_summary(results)</span>
<span id="cb33-909"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-909" tabindex="-1"></a></span>
<span id="cb33-910"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-910" tabindex="-1"></a>        logger.info(<span class="st">&quot;Analysis completed successfully.&quot;</span>)</span>
<span id="cb33-911"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-911" tabindex="-1"></a></span>
<span id="cb33-912"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-912" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb33-913"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-913" tabindex="-1"></a>        logger.error(<span class="ss">f&quot;Model execution failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb33-914"><a href="an-economic-extension-of-the-schelling-segregation-model.html#cb33-914" tabindex="-1"></a>        <span class="cf">raise</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="from-random-walks-to-social-segregation-the-schelling-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="space-matters-grids-neighborhoods-and-spatial-dynamics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/Kamran-Afzali/Agent-Based-Modelling/edit/main/05-Schelling2.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/Kamran-Afzali/Agent-Based-Modelling/blob/main/05-Schelling2.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
